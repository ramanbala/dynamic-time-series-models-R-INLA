<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Multivariate Gaussian Dynamic Modeling | Dynamic Time Series Models using R-INLA: An Applied Perspective</title>
  <meta name="description" content="This book provides examples of modeling time series data using R-INLA." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Multivariate Gaussian Dynamic Modeling | Dynamic Time Series Models using R-INLA: An Applied Perspective" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ramanbala.github.io/dynamic-time-series-models-R-INLA/" />
  <meta property="og:image" content="https://ramanbala.github.io/dynamic-time-series-models-R-INLA//book_cover_image.png" />
  <meta property="og:description" content="This book provides examples of modeling time series data using R-INLA." />
  <meta name="github-repo" content="ramanbala/dynamic-time-series-models-R-INLA" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Multivariate Gaussian Dynamic Modeling | Dynamic Time Series Models using R-INLA: An Applied Perspective" />
  
  <meta name="twitter:description" content="This book provides examples of modeling time series data using R-INLA." />
  <meta name="twitter:image" content="https://ramanbala.github.io/dynamic-time-series-models-R-INLA//book_cover_image.png" />

<meta name="author" content="Nalini Ravishanker, Balaji Raman, and Refik Soyer" />


<meta name="date" content="2022-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-st.html"/>
<link rel="next" href="ch-hmv.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Dynamic Time Series Models using R-INLA: An Applied Perspective</a></li>

<li class="divider"></li>
<li><a href="index.html#hello" id="toc-hello">Hello!<span></span></a></li>
<li><a href="preface.html#preface" id="toc-preface">Preface<span></span></a>
<ul>
<li><a href="preface.html#why-read-this-book" id="toc-why-read-this-book">Why read this book?<span></span></a></li>
<li><a href="preface.html#structure-of-the-book" id="toc-structure-of-the-book">Structure of the book<span></span></a></li>
<li><a href="preface.html#software-information-and-conventions" id="toc-software-information-and-conventions">Software information and conventions<span></span></a></li>
<li><a href="preface.html#acknowledgements" id="toc-acknowledgements">Acknowledgements<span></span></a></li>
</ul></li>
<li><a href="chapter1.html#chapter1" id="toc-chapter1"><span class="toc-section-number">1</span> Bayesian Analysis<span></span></a>
<ul>
<li><a href="chapter1.html#intro-ch1" id="toc-intro-ch1"><span class="toc-section-number">1.1</span> Introduction<span></span></a></li>
<li><a href="chapter1.html#bayes-framework" id="toc-bayes-framework"><span class="toc-section-number">1.2</span> Bayesian framework<span></span></a>
<ul>
<li><a href="chapter1.html#bayesian-model-comparison" id="toc-bayesian-model-comparison"><span class="toc-section-number">1.2.1</span> Bayesian model comparison<span></span></a></li>
</ul></li>
<li><a href="chapter1.html#bayes-ts" id="toc-bayes-ts"><span class="toc-section-number">1.3</span> Bayesian analysis of time series<span></span></a></li>
<li><a href="chapter1.html#dlms" id="toc-dlms"><span class="toc-section-number">1.4</span> Gaussian dynamic linear models (DLMs)<span></span></a>
<ul>
<li><a href="chapter1.html#constant-level-plus-noise-model" id="toc-constant-level-plus-noise-model"><span class="toc-section-number">1.4.1</span> Constant level plus noise model<span></span></a></li>
<li><a href="chapter1.html#local-level-model" id="toc-local-level-model"><span class="toc-section-number">1.4.2</span> Local level model<span></span></a></li>
<li><a href="chapter1.html#gaussian-dlm-framework-for-univariate-time-series" id="toc-gaussian-dlm-framework-for-univariate-time-series"><span class="toc-section-number">1.4.3</span> Gaussian DLM framework for univariate time series<span></span></a></li>
<li><a href="chapter1.html#ar1-plus-noise-model" id="toc-ar1-plus-noise-model"><span class="toc-section-number">1.4.4</span> AR(1) plus noise model<span></span></a></li>
<li><a href="chapter1.html#dlm-for-vector-valued-time-series" id="toc-dlm-for-vector-valued-time-series"><span class="toc-section-number">1.4.5</span> DLM for vector-valued time series<span></span></a></li>
<li><a href="chapter1.html#kalman-filtering-and-smoothing" id="toc-kalman-filtering-and-smoothing"><span class="toc-section-number">1.4.6</span> Kalman filtering and smoothing<span></span></a></li>
</ul></li>
<li><a href="chapter1.html#beyonddlm" id="toc-beyonddlm"><span class="toc-section-number">1.5</span> Beyond basic Gaussian DLMs<span></span></a></li>
<li><a href="chapter1.html#chapter-1-appendix" id="toc-chapter-1-appendix">Chapter 1 – Appendix<span></span></a>
<ul>
<li><a href="chapter1.html#conditional-distributions" id="toc-conditional-distributions">Conditional distributions<span></span></a></li>
<li><a href="chapter1.html#exponential-family-of-distributions" id="toc-exponential-family-of-distributions">Exponential family of distributions<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="chapter2.html#chapter2" id="toc-chapter2"><span class="toc-section-number">2</span> A Review of INLA<span></span></a>
<ul>
<li><a href="chapter2.html#intro-ch2" id="toc-intro-ch2"><span class="toc-section-number">2.1</span> Introduction<span></span></a></li>
<li><a href="chapter2.html#laplace" id="toc-laplace"><span class="toc-section-number">2.2</span> Laplace approximation<span></span></a>
<ul>
<li><a href="chapter2.html#simplaplace" id="toc-simplaplace"><span class="toc-section-number">2.2.1</span> Simplified Laplace approximation<span></span></a></li>
</ul></li>
<li><a href="chapter2.html#inlats" id="toc-inlats"><span class="toc-section-number">2.3</span> INLA structure for time series<span></span></a>
<ul>
<li><a href="chapter2.html#inla-steps" id="toc-inla-steps"><span class="toc-section-number">2.3.1</span> INLA steps<span></span></a></li>
</ul></li>
<li><a href="chapter2.html#forecast" id="toc-forecast"><span class="toc-section-number">2.4</span> Forecasting in INLA<span></span></a></li>
<li><a href="chapter2.html#marglik" id="toc-marglik"><span class="toc-section-number">2.5</span> Marginal likelihood computation in INLA<span></span></a></li>
<li><a href="chapter2.html#rinlapkg" id="toc-rinlapkg"><span class="toc-section-number">2.6</span> <code>R-INLA</code> package – some basics<span></span></a></li>
<li><a href="chapter2.html#chapter-2-appendix" id="toc-chapter-2-appendix">Chapter 2 – Appendix<span></span></a>
<ul>
<li><a href="chapter2.html#gaussian-markov-random-field-gmrf" id="toc-gaussian-markov-random-field-gmrf">Gaussian Markov Random Field (GMRF)<span></span></a></li>
<li><a href="chapter2.html#kullback-leibler-divergence" id="toc-kullback-leibler-divergence">Kullback-Leibler divergence<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="chapter3.html#chapter3" id="toc-chapter3"><span class="toc-section-number">3</span> Details of R-INLA for Time Series<span></span></a>
<ul>
<li><a href="chapter3.html#intro-ch3" id="toc-intro-ch3"><span class="toc-section-number">3.1</span> Introduction<span></span></a></li>
<li><a href="chapter3.html#ch3-rw1noise" id="toc-ch3-rw1noise"><span class="toc-section-number">3.2</span> Random walk plus noise model<span></span></a>
<ul>
<li><a href="chapter3.html#inlaformula" id="toc-inlaformula"><span class="toc-section-number">3.2.1</span> <code>R-INLA</code> model formula<span></span></a></li>
<li><a href="chapter3.html#inlaexec" id="toc-inlaexec"><span class="toc-section-number">3.2.2</span> Model execution<span></span></a></li>
<li><a href="chapter3.html#inlaprior" id="toc-inlaprior"><span class="toc-section-number">3.2.3</span> Prior specifications for hyperparameters<span></span></a></li>
<li><a href="chapter3.html#inlaposterior" id="toc-inlaposterior"><span class="toc-section-number">3.2.4</span> Posterior distributions of hyperparameters<span></span></a></li>
<li><a href="chapter3.html#fittedvalues" id="toc-fittedvalues"><span class="toc-section-number">3.2.5</span> Fitted values for latent states and responses<span></span></a></li>
<li><a href="chapter3.html#filterestimate" id="toc-filterestimate"><span class="toc-section-number">3.2.6</span> Filtering and smoothing in DLM<span></span></a></li>
</ul></li>
<li><a href="chapter3.html#ch3-ar1levelnoise" id="toc-ch3-ar1levelnoise"><span class="toc-section-number">3.3</span> AR(1) with level plus noise model<span></span></a></li>
<li><a href="chapter3.html#ch3-high-lags" id="toc-ch3-high-lags"><span class="toc-section-number">3.4</span> Dynamic linear models with higher order AR lags<span></span></a>
<ul>
<li><a href="chapter3.html#arp-with-level-plus-noise-model" id="toc-arp-with-level-plus-noise-model">AR<span class="math inline">\((p)\)</span> with level plus noise model<span></span></a></li>
</ul></li>
<li><a href="chapter3.html#ch3-rwdrift" id="toc-ch3-rwdrift"><span class="toc-section-number">3.5</span> Random walk with drift plus noise model<span></span></a></li>
<li><a href="chapter3.html#ch3-rwtvdrift" id="toc-ch3-rwtvdrift"><span class="toc-section-number">3.6</span> Second-order polynomial model<span></span></a></li>
<li><a href="chapter3.html#forecasting" id="toc-forecasting"><span class="toc-section-number">3.7</span> Forecasting states and observations<span></span></a></li>
<li><a href="chapter3.html#modsel" id="toc-modsel"><span class="toc-section-number">3.8</span> Model comparisons<span></span></a>
<ul>
<li><a href="chapter3.html#modsel-insamp-ch3" id="toc-modsel-insamp-ch3"><span class="toc-section-number">3.8.1</span> In-sample model comparisons<span></span></a></li>
<li><a href="chapter3.html#modsel-outsamp-ch3" id="toc-modsel-outsamp-ch3"><span class="toc-section-number">3.8.2</span> Out-of-sample comparisons<span></span></a></li>
</ul></li>
<li><a href="chapter3.html#nondefault-priors" id="toc-nondefault-priors"><span class="toc-section-number">3.9</span> Non-default prior specifications<span></span></a>
<ul>
<li><a href="chapter3.html#custom-priors" id="toc-custom-priors"><span class="toc-section-number">3.9.1</span> Custom prior specifications<span></span></a></li>
<li><a href="chapter3.html#pc-priors" id="toc-pc-priors"><span class="toc-section-number">3.9.2</span> Penalized complexity (PC) priors<span></span></a></li>
</ul></li>
<li><a href="chapter3.html#post-sampling" id="toc-post-sampling"><span class="toc-section-number">3.10</span> Posterior sampling of latent effects and hyperparameters<span></span></a></li>
<li><a href="chapter3.html#postpred-samples" id="toc-postpred-samples"><span class="toc-section-number">3.11</span> Posterior predictive samples of unknown observations<span></span></a></li>
<li><a href="chapter3.html#chapter-3-appendix" id="toc-chapter-3-appendix">Chapter 3 – Appendix<span></span></a>
<ul>
<li><a href="chapter3.html#sampling-properties-of-time-series" id="toc-sampling-properties-of-time-series">Sampling properties of time series<span></span></a></li>
<li><a href="chapter3.html#autoregressive-models" id="toc-autoregressive-models">Autoregressive models<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="chapter4.html#chapter4" id="toc-chapter4"><span class="toc-section-number">4</span> Modeling Univariate Time Series<span></span></a>
<ul>
<li><a href="chapter4.html#intro-ch4" id="toc-intro-ch4"><span class="toc-section-number">4.1</span> Introduction<span></span></a></li>
<li><a href="chapter4.html#dat-analysis" id="toc-dat-analysis"><span class="toc-section-number">4.2</span> Example: A software engineering example – Musa data<span></span></a>
<ul>
<li><a href="chapter4.html#ch4-model1" id="toc-ch4-model1"><span class="toc-section-number">4.2.1</span> Model 1. AR(1) with level plus noise model<span></span></a></li>
<li><a href="chapter4.html#ch4-model2" id="toc-ch4-model2"><span class="toc-section-number">4.2.2</span> Model 2. Random walk plus noise model<span></span></a></li>
<li><a href="chapter4.html#ch4-model3" id="toc-ch4-model3"><span class="toc-section-number">4.2.3</span> Model 3. AR(1) with trend plus noise model<span></span></a></li>
<li><a href="chapter4.html#ch4-model4" id="toc-ch4-model4"><span class="toc-section-number">4.2.4</span> Model 4. AR(2) with level plus noise model<span></span></a></li>
</ul></li>
<li><a href="chapter4.html#forecasting-musa" id="toc-forecasting-musa"><span class="toc-section-number">4.3</span> Forecasting future states and responses<span></span></a></li>
<li><a href="chapter4.html#modsel-ch4" id="toc-modsel-ch4"><span class="toc-section-number">4.4</span> Model comparisons<span></span></a>
<ul>
<li><a href="chapter4.html#in-sample-comparisons" id="toc-in-sample-comparisons">In-sample comparisons<span></span></a></li>
<li><a href="chapter4.html#out-of-sample-comparisons" id="toc-out-of-sample-comparisons">Out-of-sample comparisons<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="chapter5.html#chapter5" id="toc-chapter5"><span class="toc-section-number">5</span> Time Series Regression Models<span></span></a>
<ul>
<li><a href="chapter5.html#intro-ch5" id="toc-intro-ch5"><span class="toc-section-number">5.1</span> Introduction<span></span></a></li>
<li><a href="chapter5.html#ch5-strdecomp" id="toc-ch5-strdecomp"><span class="toc-section-number">5.2</span> Structural models<span></span></a>
<ul>
<li><a href="chapter5.html#hotelcost" id="toc-hotelcost"><span class="toc-section-number">5.2.1</span> Example: Monthly average cost of nightly hotel stay<span></span></a></li>
</ul></li>
<li><a href="chapter5.html#ch5-exogpreds" id="toc-ch5-exogpreds"><span class="toc-section-number">5.3</span> Models with exogenous predictors<span></span></a>
<ul>
<li><a href="chapter5.html#hourly-traffic" id="toc-hourly-traffic"><span class="toc-section-number">5.3.1</span> Example: Hourly traffic volumes<span></span></a></li>
</ul></li>
<li><a href="chapter5.html#ar1c" id="toc-ar1c"><span class="toc-section-number">5.4</span> Latent AR(1) model with covariates plus noise<span></span></a></li>
</ul></li>
<li><a href="chapter6.html#chapter6" id="toc-chapter6"><span class="toc-section-number">6</span> Hierarchical Dynamic Models for Panel Time Series<span></span></a>
<ul>
<li><a href="chapter6.html#intro-ch6" id="toc-intro-ch6"><span class="toc-section-number">6.1</span> Introduction<span></span></a></li>
<li><a href="chapter6.html#homog-state" id="toc-homog-state"><span class="toc-section-number">6.2</span> Models with homogenous state evolution<span></span></a>
<ul>
<li><a href="chapter6.html#simul1-panelts" id="toc-simul1-panelts"><span class="toc-section-number">6.2.1</span> Example: Simulated homogeneous panel time series with the same level<span></span></a></li>
<li><a href="chapter6.html#simul2-panelts" id="toc-simul2-panelts"><span class="toc-section-number">6.2.2</span> Example: Simulated homogeneous panel time series with different levels<span></span></a></li>
</ul></li>
<li><a href="chapter6.html#ridesource-hdlm" id="toc-ridesource-hdlm"><span class="toc-section-number">6.3</span> Example: Ridesourcing in NYC<span></span></a>
<ul>
<li><a href="chapter6.html#description-of-variables" id="toc-description-of-variables">Description of variables<span></span></a></li>
<li><a href="chapter6.html#hmod.H1" id="toc-hmod.H1"><span class="toc-section-number">6.3.1</span> Model H1. Dynamic intercept and exogenous predictors<span></span></a></li>
<li><a href="chapter6.html#hmod.H2" id="toc-hmod.H2"><span class="toc-section-number">6.3.2</span> Model H2. Dynamic intercept and Taxi usage<span></span></a></li>
<li><a href="chapter6.html#hmod.H3" id="toc-hmod.H3"><span class="toc-section-number">6.3.3</span> Model H3. Taxi usage varies by time and zone<span></span></a></li>
<li><a href="chapter6.html#hmod.H4" id="toc-hmod.H4"><span class="toc-section-number">6.3.4</span> Model H4. Fixed intercept, Taxi usage varies over time and zones<span></span></a></li>
</ul></li>
<li><a href="chapter6.html#model-comparison" id="toc-model-comparison"><span class="toc-section-number">6.4</span> Model comparison<span></span></a></li>
</ul></li>
<li><a href="ch-nongaus.html#ch-nongaus" id="toc-ch-nongaus"><span class="toc-section-number">7</span> Non-Gaussian Continuous Responses<span></span></a>
<ul>
<li><a href="ch-nongaus.html#intro-nongaus" id="toc-intro-nongaus"><span class="toc-section-number">7.1</span> Introduction<span></span></a></li>
<li><a href="ch-nongaus.html#gamma-model" id="toc-gamma-model"><span class="toc-section-number">7.2</span> Gamma state space model<span></span></a>
<ul>
<li><a href="ch-nongaus.html#vix" id="toc-vix"><span class="toc-section-number">7.2.1</span> Example: Volatility index (VIX) time series<span></span></a></li>
</ul></li>
<li><a href="ch-nongaus.html#weibull-model" id="toc-weibull-model"><span class="toc-section-number">7.3</span> Weibull state space model<span></span></a>
<ul>
<li><a href="ch-nongaus.html#forecasting-from-weibull-models" id="toc-forecasting-from-weibull-models"><span class="toc-section-number">7.3.1</span> Forecasting from Weibull models<span></span></a></li>
</ul></li>
<li><a href="ch-nongaus.html#beta-model" id="toc-beta-model"><span class="toc-section-number">7.4</span> Beta state space model<span></span></a>
<ul>
<li><a href="ch-nongaus.html#crest" id="toc-crest"><span class="toc-section-number">7.4.1</span> Example: Crest market share<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="ch-binary.html#ch-binary" id="toc-ch-binary"><span class="toc-section-number">8</span> Modeling Categorical Time Series<span></span></a>
<ul>
<li><a href="ch-binary.html#intro-ch-binary" id="toc-intro-ch-binary"><span class="toc-section-number">8.1</span> Introduction<span></span></a></li>
<li><a href="ch-binary.html#bin-model" id="toc-bin-model"><span class="toc-section-number">8.2</span> Binomial response time series<span></span></a>
<ul>
<li><a href="ch-binary.html#simul-bin" id="toc-simul-bin"><span class="toc-section-number">8.2.1</span> Example: Simulated single binomial response series<span></span></a></li>
<li><a href="ch-binary.html#bin-weekly-shopping" id="toc-bin-weekly-shopping"><span class="toc-section-number">8.2.2</span> Example: Weekly shopping trips for a single household<span></span></a></li>
</ul></li>
<li><a href="ch-binary.html#hbin" id="toc-hbin"><span class="toc-section-number">8.3</span> Modeling multiple binomial response time series<span></span></a>
<ul>
<li><a href="ch-binary.html#simul-hbin" id="toc-simul-hbin"><span class="toc-section-number">8.3.1</span> Example: Dynamic aggregated model for multiple binomial response time series<span></span></a></li>
<li><a href="ch-binary.html#hbin-weekly-shopping" id="toc-hbin-weekly-shopping"><span class="toc-section-number">8.3.2</span> Example: Weekly shopping trips for multiple households<span></span></a></li>
</ul></li>
<li><a href="ch-binary.html#cat-models" id="toc-cat-models"><span class="toc-section-number">8.4</span> Multinomial time series<span></span></a>
<ul>
<li><a href="ch-binary.html#simul-mn-p" id="toc-simul-mn-p"><span class="toc-section-number">8.4.1</span> Example: Simulated categorical time series<span></span></a></li>
<li><a href="ch-binary.html#model-d4-dynamic-coefficient-for-c_jt" id="toc-model-d4-dynamic-coefficient-for-c_jt">Model D4: Dynamic coefficient for <span class="math inline">\(C_{j,t}\)</span><span></span></a></li>
</ul></li>
<li><a href="ch-binary.html#chapter-8-appendix" id="toc-chapter-8-appendix">Chapter 8 – Appendix<span></span></a>
<ul>
<li><a href="ch-binary.html#poisson-trick-for-multinomial-models" id="toc-poisson-trick-for-multinomial-models">Poisson-trick for multinomial models<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="ch-count.html#ch-count" id="toc-ch-count"><span class="toc-section-number">9</span> Modeling Count Time Series<span></span></a>
<ul>
<li><a href="ch-count.html#intro-ch-count" id="toc-intro-ch-count"><span class="toc-section-number">9.1</span> Introduction<span></span></a></li>
<li><a href="ch-count.html#uvcounts" id="toc-uvcounts"><span class="toc-section-number">9.2</span> Univariate time series of counts<span></span></a>
<ul>
<li><a href="ch-count.html#uvcounts-simpois" id="toc-uvcounts-simpois"><span class="toc-section-number">9.2.1</span> Example: Simulated univariate Poisson counts<span></span></a></li>
<li><a href="ch-count.html#uvcounts-crashct" id="toc-uvcounts-crashct"><span class="toc-section-number">9.2.2</span> Example: Modeling crash counts in CT<span></span></a></li>
<li><a href="ch-count.html#uvcounts-bikerental" id="toc-uvcounts-bikerental"><span class="toc-section-number">9.2.3</span> Example: Daily bike rentals in Washington D.C.<span></span></a></li>
</ul></li>
<li><a href="ch-count.html#hieruvcounts" id="toc-hieruvcounts"><span class="toc-section-number">9.3</span> Hierarchical modeling of univariate count time series<span></span></a>
<ul>
<li><a href="ch-count.html#simul1-hcount" id="toc-simul1-hcount"><span class="toc-section-number">9.3.1</span> Example: Simulated univariate Poisson counts<span></span></a></li>
<li><a href="ch-count.html#tnc-hcount" id="toc-tnc-hcount"><span class="toc-section-number">9.3.2</span> Example: Modeling daily TNC usage in NYC<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="ch-sv.html#ch-sv" id="toc-ch-sv"><span class="toc-section-number">10</span> Modeling Stochastic Volatility<span></span></a>
<ul>
<li><a href="ch-sv.html#ch-sv-intro" id="toc-ch-sv-intro"><span class="toc-section-number">10.1</span> Introduction<span></span></a></li>
<li><a href="ch-sv.html#sv-uv" id="toc-sv-uv"><span class="toc-section-number">10.2</span> Univariate SV models<span></span></a>
<ul>
<li><a href="ch-sv.html#simul-svnormal" id="toc-simul-svnormal"><span class="toc-section-number">10.2.1</span> Example: Simulated SV data with standard normal errors<span></span></a></li>
<li><a href="ch-sv.html#simul-svt5" id="toc-simul-svt5"><span class="toc-section-number">10.2.2</span> Example: Simulated SV data with Student-<span class="math inline">\(t_{\nu}\)</span> errors<span></span></a></li>
<li><a href="ch-sv.html#stockrets" id="toc-stockrets"><span class="toc-section-number">10.2.3</span> Example: IBM stock returns<span></span></a></li>
<li><a href="ch-sv.html#nysestockrets" id="toc-nysestockrets"><span class="toc-section-number">10.2.4</span> Example: NYSE returns<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="ch-st.html#ch-st" id="toc-ch-st"><span class="toc-section-number">11</span> Spatio-temporal Modeling<span></span></a>
<ul>
<li><a href="ch-st.html#ch-st-intro" id="toc-ch-st-intro"><span class="toc-section-number">11.1</span> Introduction<span></span></a></li>
<li><a href="ch-st.html#st-process" id="toc-st-process"><span class="toc-section-number">11.2</span> Spatio-temporal process<span></span></a></li>
<li><a href="ch-st.html#dyn-areal-model" id="toc-dyn-areal-model"><span class="toc-section-number">11.3</span> Dynamic spatial models for areal data<span></span></a></li>
<li><a href="ch-st.html#st-tnc-example" id="toc-st-tnc-example"><span class="toc-section-number">11.4</span> Example: Monthly TNC usage in NYC taxi zones<span></span></a>
<ul>
<li><a href="ch-st.html#data-preprocessing" id="toc-data-preprocessing">Data preprocessing<span></span></a></li>
<li><a href="ch-st.html#st-tnc-kh" id="toc-st-tnc-kh"><span class="toc-section-number">11.4.1</span> Model 1. Knorr-Held additive effects model<span></span></a></li>
<li><a href="ch-st.html#st-tnc-kh-inter" id="toc-st-tnc-kh-inter"><span class="toc-section-number">11.4.2</span> Knorr-Held models with space-time interactions<span></span></a></li>
<li><a href="ch-st.html#model-kh3.-knorr-held-model-with-interaction-between-epsilon_i-and-gamma_t" id="toc-model-kh3.-knorr-held-model-with-interaction-between-epsilon_i-and-gamma_t">Model KH3. Knorr-Held model with interaction between <span class="math inline">\(\epsilon_i\)</span> and <span class="math inline">\(\gamma_t\)</span><span></span></a></li>
<li><a href="ch-st.html#model-kh4.-knorr-held-model-with-interaction-between-nu_i-and-gamma_t" id="toc-model-kh4.-knorr-held-model-with-interaction-between-nu_i-and-gamma_t">Model KH4. Knorr-Held model with interaction between <span class="math inline">\(\nu_i\)</span> and <span class="math inline">\(\gamma_t\)</span><span></span></a></li>
</ul></li>
</ul></li>
<li><a href="chmvdlm.html#chmvdlm" id="toc-chmvdlm"><span class="toc-section-number">12</span> Multivariate Gaussian Dynamic Modeling<span></span></a>
<ul>
<li><a href="chmvdlm.html#intro-chmvdlm" id="toc-intro-chmvdlm"><span class="toc-section-number">12.1</span> Introduction<span></span></a></li>
<li><a href="chmvdlm.html#MVDiagWPhi" id="toc-MVDiagWPhi"><span class="toc-section-number">12.2</span> Model with diagonal <span class="math inline">\(\boldsymbol W\)</span> and <span class="math inline">\(\boldsymbol \Phi\)</span> matrices<span></span></a>
<ul>
<li><a href="chmvdlm.html#V-setup" id="toc-V-setup"><span class="toc-section-number">12.2.1</span> Description of the setup for <span class="math inline">\(\boldsymbol V\)</span><span></span></a></li>
<li><a href="chmvdlm.html#simbivar1" id="toc-simbivar1"><span class="toc-section-number">12.2.2</span> Example: Simulated bivariate AR(1) series<span></span></a></li>
<li><a href="chmvdlm.html#tnctaxi-onezone" id="toc-tnctaxi-onezone"><span class="toc-section-number">12.2.3</span> Example: Ridesourcing data in NYC for a single taxi zone<span></span></a></li>
</ul></li>
<li><a href="chmvdlm.html#MVICCWPhi" id="toc-MVICCWPhi"><span class="toc-section-number">12.3</span> Model with equicorrelated <span class="math inline">\(\boldsymbol{w}_t\)</span> and diagonal <span class="math inline">\(\boldsymbol \Phi\)</span><span></span></a>
<ul>
<li><a href="chmvdlm.html#simtrivar1" id="toc-simtrivar1"><span class="toc-section-number">12.3.1</span> Example: Simulated trivariate series<span></span></a></li>
</ul></li>
<li><a href="chmvdlm.html#rgenericmv" id="toc-rgenericmv"><span class="toc-section-number">12.4</span> Fitting multivariate models using <code>rgeneric</code><span></span></a>
<ul>
<li><a href="chmvdlm.html#simulgen" id="toc-simulgen"><span class="toc-section-number">12.4.1</span> Example: Simulated bivariate VAR(1) series<span></span></a></li>
</ul></li>
<li><a href="chmvdlm.html#chapter-12-appendix" id="toc-chapter-12-appendix">Chapter 12 – Appendix<span></span></a></li>
</ul></li>
<li><a href="ch-hmv.html#ch-hmv" id="toc-ch-hmv"><span class="toc-section-number">13</span> Hierarchical Multivariate Time Series<span></span></a>
<ul>
<li><a href="ch-hmv.html#intro-ch-hmv" id="toc-intro-ch-hmv"><span class="toc-section-number">13.1</span> Introduction<span></span></a></li>
<li><a href="ch-hmv.html#mvhdlm" id="toc-mvhdlm"><span class="toc-section-number">13.2</span> Multivariate hierarchical dynamic linear model<span></span></a>
<ul>
<li><a href="ch-hmv.html#response-and-predictor-variables" id="toc-response-and-predictor-variables">Response and predictor variables<span></span></a></li>
<li><a href="ch-hmv.html#model-setup" id="toc-model-setup">Model setup<span></span></a></li>
<li><a href="ch-hmv.html#tnc-taxi-hmv" id="toc-tnc-taxi-hmv"><span class="toc-section-number">13.2.1</span> Example: Analysis of TNC and Taxi as responses<span></span></a></li>
</ul></li>
<li><a href="ch-hmv.html#lcmcounts" id="toc-lcmcounts"><span class="toc-section-number">13.3</span> Level correlated models for multivariate time series of counts<span></span></a>
<ul>
<li><a href="ch-hmv.html#tnc-taxi-daily" id="toc-tnc-taxi-daily"><span class="toc-section-number">13.3.1</span> Example: TNC and Taxi counts based on daily data<span></span></a></li>
</ul></li>
</ul></li>
<li><a href="resources.html#resources" id="toc-resources"><span class="toc-section-number">14</span> Resources for the User<span></span></a>
<ul>
<li><a href="resources.html#intro-resources" id="toc-intro-resources"><span class="toc-section-number">14.1</span> Introduction<span></span></a></li>
<li><a href="resources.html#package-list" id="toc-package-list"><span class="toc-section-number">14.2</span> Packages used in the book<span></span></a></li>
<li><a href="resources.html#custom-functions" id="toc-custom-functions"><span class="toc-section-number">14.3</span> Custom functions used in the book<span></span></a>
<ul>
<li><a href="resources.html#basic-plotting-functions" id="toc-basic-plotting-functions">Basic plotting functions<span></span></a></li>
<li><a href="resources.html#functions-for-forecast-evaluation" id="toc-functions-for-forecast-evaluation">Functions for forecast evaluation<span></span></a></li>
<li><a href="resources.html#function-for-model-comparison" id="toc-function-for-model-comparison">Function for model comparison<span></span></a></li>
<li><a href="resources.html#function-for-the-filtering-algorithm-in-dlm" id="toc-function-for-the-filtering-algorithm-in-dlm">Function for the filtering algorithm in DLM<span></span></a></li>
<li><a href="resources.html#rgeneric-fn" id="toc-rgeneric-fn"><span class="toc-section-number">14.3.1</span> <code>rgeneric()</code> function for DLM-VAR model<span></span></a></li>
</ul></li>
<li><a href="resources.html#items-often-used" id="toc-items-often-used"><span class="toc-section-number">14.4</span> Often used <code>R-INLA</code> items<span></span></a>
<ul>
<li><a href="resources.html#control-options" id="toc-control-options">Control options<span></span></a></li>
<li><a href="resources.html#options-for-computing-marginals" id="toc-options-for-computing-marginals">Options for computing marginals<span></span></a></li>
<li><a href="resources.html#random-effect-specifications" id="toc-random-effect-specifications">Random effect specifications<span></span></a></li>
<li><a href="resources.html#prior-specifications" id="toc-prior-specifications">Prior specifications<span></span></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Dynamic Time Series Models using R-INLA: An Applied Perspective</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chmvdlm" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> Multivariate Gaussian Dynamic Modeling<a href="chmvdlm.html#chmvdlm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro-chmvdlm" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Introduction<a href="chmvdlm.html#intro-chmvdlm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter describes dynamic Bayesian modeling for Gaussian multivariate time series.
For <span class="math inline">\(t=1,\ldots,n\)</span>, let <span class="math inline">\(\boldsymbol y_t =(Y_{1,t}, \ldots, Y_{q,t})&#39;\)</span> be a <span class="math inline">\(q\)</span>-dimensional time series that is linearly related to a latent <span class="math inline">\(p\)</span>-dimensional process <span class="math inline">\(\boldsymbol x_t=(X_{1,t}, \ldots, X_{p,t})&#39;\)</span>,
plus a <span class="math inline">\(q\)</span>-dimensional vector of Gaussian errors
<span class="math inline">\(\boldsymbol v_t = (v_{1,t}, \ldots, v_{q,t})&#39;\)</span> with mean <span class="math inline">\(\boldsymbol 0\)</span> and covariance <span class="math inline">\(\boldsymbol V\)</span>. For <span class="math inline">\(t=1,\ldots,n\)</span>, the observation equation is</p>
<p><span class="math display" id="eq:vec-obs">\[\begin{align}
\boldsymbol y_t = \boldsymbol F_t \boldsymbol x_t + \boldsymbol v_t,
\tag{12.1}
\end{align}\]</span>
where the observation error vector <span class="math inline">\(\boldsymbol v_t \sim N_{q}(\boldsymbol 0, \boldsymbol V)\)</span> and
<span class="math inline">\(\boldsymbol F_t\)</span> is a known, measurement matrix (similar to the design/regression matrix in a static linear model). The state vector <span class="math inline">\(\boldsymbol x_t\)</span> is assumed to evolve as a first-order vector
AR process, i.e., a VAR(1) process. The state equation is</p>
<p><span class="math display" id="eq:vec-st">\[\begin{align}
\boldsymbol x_t = \boldsymbol{\Phi} \boldsymbol x_{t-1} +  \boldsymbol w_t,
\tag{12.2}
\end{align}\]</span>
where the state error vector <span class="math inline">\(\boldsymbol w_t \sim N_{p}(\boldsymbol 0, \boldsymbol W)\)</span>, and
<span class="math inline">\(\boldsymbol{\Phi} =\{\phi_{ij}\}\)</span> is a <span class="math inline">\(p \times p\)</span> state transition matrix.
We described these models with additional exogenous predictors in <a href="chapter1.html#eq:dlm-obseq">(1.21)</a> and <a href="chapter1.html#eq:dlm-steq">(1.22)</a>.
For more details on the Gaussian DLM and model fitting using the <code>R</code> package <code>astsa</code>, see <span class="citation">Shumway and Stoffer (<a href="#ref-ss2017" role="doc-biblioref">2017</a>)</span>. Multivariate models can also be implemented using software such as WinBUGS or STAN.</p>
<p>In this chapter, we describe how to use <code>R-INLA</code> to fit a multivariate (MV) DLM in the following situations. In all cases, the observation errors are assumed to be correlated, so that <span class="math inline">\(\boldsymbol V\)</span> is a non-diagonal p.d. matrix. We discuss these cases in the following sections.</p>
<ol style="list-style-type: lower-alpha">
<li><p>The state variables follow independent AR(1) processes; i.e., <span class="math inline">\(\boldsymbol W\)</span> and <span class="math inline">\(\boldsymbol \Phi\)</span> are diagonal matrices (see Section <a href="chmvdlm.html#MVDiagWPhi">12.2</a>).</p></li>
<li><p>The state errors are equicorrelated, so that <span class="math inline">\(\boldsymbol W\)</span> has an intra-class covariance structure. Further, the AR(1) models for each state component have the same coefficient <span class="math inline">\(\phi\)</span>, so that the matrix <span class="math inline">\(\boldsymbol \Phi\)</span> in the VAR(1) model is diagonal with a common <span class="math inline">\(\phi\)</span> value along the diagonal (see Section <a href="chmvdlm.html#MVICCWPhi">12.3</a>).</p></li>
<li><p>The state errors are uncorrelated so that <span class="math inline">\(\boldsymbol W\)</span> is diagonal, while the matrix <span class="math inline">\(\Phi\)</span> is a full <span class="math inline">\(p \times p\)</span> matrix accommodating dependence in the state vector
(see Section <a href="chmvdlm.html#rgenericmv">12.4</a>).</p></li>
</ol>
<p>Custom functions must be sourced by the user.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="chmvdlm.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions_custom.R&quot;</span>)</span></code></pre></div>
<p>We use the following packages.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="chmvdlm.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb323-2"><a href="chmvdlm.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb323-3"><a href="chmvdlm.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb323-4"><a href="chmvdlm.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marima)</span>
<span id="cb323-5"><a href="chmvdlm.html#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vars)</span>
<span id="cb323-6"><a href="chmvdlm.html#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(matrixcalc)</span>
<span id="cb323-7"><a href="chmvdlm.html#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>We analyze the following data.</p>
<ol style="list-style-type: decimal">
<li>Ridesourcing in NYC</li>
</ol>
</div>
<div id="MVDiagWPhi" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Model with diagonal <span class="math inline">\(\boldsymbol W\)</span> and <span class="math inline">\(\boldsymbol \Phi\)</span> matrices<a href="chmvdlm.html#MVDiagWPhi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We assume that the state error covariance matrix <span class="math inline">\(\boldsymbol W\)</span> and the state transition matrix <span class="math inline">\(\boldsymbol \Phi\)</span> are diagonal matrices. However, the observation error
covariance matrix <span class="math inline">\(\boldsymbol V\)</span> is a non-diagonal, symmetric p.d. matrix.
We first show a simulated example of a bivariate DLM, followed by an illustration using the ridesourcing data for a single taxi zone in NYC.</p>
<div id="V-setup" class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Description of the setup for <span class="math inline">\(\boldsymbol V\)</span><a href="chmvdlm.html#V-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose that for all <span class="math inline">\(t\)</span>, the observation errors <span class="math inline">\(v_{j,t} \sim N(0, V_{jj}),~j=1,\ldots,q\)</span>,
and that
<span class="math inline">\(Corr(v_{j,t},v_{\ell,t}) = 1\)</span> if <span class="math inline">\(j=\ell\)</span> and <span class="math inline">\(R_{j \ell}\)</span> if <span class="math inline">\(j \neq \ell, j, \ell=1,\ldots,q\)</span>.
Let Cov<span class="math inline">\((\boldsymbol v_{t}) = \boldsymbol V =\{V_{j\ell}\}\)</span> and Corr<span class="math inline">\((\boldsymbol v_{t}) = \boldsymbol R =\{R_{j\ell}\}\)</span>.
Let <span class="math inline">\(\boldsymbol{D}_v =\text{diag}(V_{11}, \ldots,V_{qq})\)</span>.
Here, <span class="math inline">\(\boldsymbol V\)</span>, <span class="math inline">\(\boldsymbol R\)</span>, and <span class="math inline">\(\boldsymbol{D}_v\)</span> are <span class="math inline">\(q \times q\)</span> symmetric p.d. matrices, and
<span class="math inline">\(\boldsymbol R = \boldsymbol{D}_v^{-1/2}\boldsymbol V \boldsymbol{D}_v^{-1/2}\)</span>. For <span class="math inline">\(q=2\)</span>,</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol V = \begin{pmatrix}
V_{11} &amp; V_{12} \\
V_{12} &amp; V_{22}
\end{pmatrix}
= \begin{pmatrix}
\frac{1}{\tau_{11}} &amp; \frac{R_{12}}{\sqrt{\tau_{11} \tau_{22}}} \\
\frac{R_{12}}{\sqrt{\tau_{11} \tau_{22}}} &amp; \frac{1}{\tau_{22}}
\end{pmatrix},
\end{align*}\]</span>
where the marginal precisions of <span class="math inline">\(v_{1,t}\)</span> and <span class="math inline">\(v_{2,t}\)</span> are
<span class="math inline">\(\tau_{11}=1/V_{11}\)</span> and <span class="math inline">\(\tau_{22}=1/V_{22}\)</span>, while
the correlation between <span class="math inline">\(v_{1,t}\)</span> and <span class="math inline">\(v_{2,t}\)</span> is
<span class="math inline">\(R_{12}= V_{12}/\sqrt{V_{11}V_{22}}\)</span>.
In <code>R-INLA</code>, the hyperparameters are <span class="math inline">\(\tau_{11}, \tau_{22}\)</span>, and <span class="math inline">\(R_{12}\)</span>. The
precision matrix <span class="math inline">\(\boldsymbol V^{-1}\)</span> is assumed to follow a Wishart distribution, denoted as
<span class="math inline">\(\boldsymbol V^{-1} \sim \mathcal{W}(r,\boldsymbol \Sigma^{-1})\)</span>, and we say that <span class="math inline">\(\boldsymbol V\)</span> follows an
inverse Wishart distribution with d.f. <span class="math inline">\(r\)</span> and scale matrix <span class="math inline">\(\boldsymbol \Sigma^{-1}\)</span>.
The “iid2d” option enables us to handle this for augmented structures in multivariate models, following discussion similar to Section 3.3.8 from <span class="citation">Gómez-Rubio (<a href="#ref-gomez2020bayesian" role="doc-biblioref">2020</a>)</span>.</p>
</div>
<div id="simbivar1" class="section level3 hasAnchor" number="12.2.2">
<h3><span class="header-section-number">12.2.2</span> Example: Simulated bivariate AR(1) series<a href="chmvdlm.html#simbivar1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assume that the observation and state equations are</p>
<p><span class="math display" id="eq:vec-obs-sim">\[\begin{align}
\boldsymbol y_t  &amp; = \boldsymbol x_t + \boldsymbol v_t, \notag \\
\boldsymbol x_t &amp; = \boldsymbol{\Phi} \boldsymbol x_{t-1} +  \boldsymbol w_t.
\tag{12.3}
\end{align}\]</span>
For the simulation, we first set up observation error and state error covariance matrices.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="chmvdlm.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observation error covariance V</span></span>
<span id="cb324-2"><a href="chmvdlm.html#cb324-2" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fl">1.0</span> </span>
<span id="cb324-3"><a href="chmvdlm.html#cb324-3" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb324-4"><a href="chmvdlm.html#cb324-4" aria-hidden="true" tabindex="-1"></a>R<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb324-5"><a href="chmvdlm.html#cb324-5" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.12</span> <span class="ot">&lt;-</span> R<span class="fl">.12</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.11</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.22</span>)</span>
<span id="cb324-6"><a href="chmvdlm.html#cb324-6" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(V<span class="fl">.11</span>, V<span class="fl">.12</span>, V<span class="fl">.12</span>, V<span class="fl">.22</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb324-7"><a href="chmvdlm.html#cb324-7" aria-hidden="true" tabindex="-1"></a><span class="co"># State error covariance W</span></span>
<span id="cb324-8"><a href="chmvdlm.html#cb324-8" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb324-9"><a href="chmvdlm.html#cb324-9" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb324-10"><a href="chmvdlm.html#cb324-10" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb324-11"><a href="chmvdlm.html#cb324-11" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(W<span class="fl">.11</span>, W<span class="fl">.12</span>, W<span class="fl">.12</span>, W<span class="fl">.22</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Since the true <span class="math inline">\(\boldsymbol{\Phi}\)</span> matrix is diagonal, we can compute the precision of the state variables as</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="chmvdlm.html#cb325-1" aria-hidden="true" tabindex="-1"></a>phi<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb325-2"><a href="chmvdlm.html#cb325-2" aria-hidden="true" tabindex="-1"></a>phi<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb325-3"><a href="chmvdlm.html#cb325-3" aria-hidden="true" tabindex="-1"></a>prec.x1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> phi<span class="fl">.1</span> <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> W<span class="fl">.11</span></span>
<span id="cb325-4"><a href="chmvdlm.html#cb325-4" aria-hidden="true" tabindex="-1"></a>prec.x2 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> phi<span class="fl">.2</span> <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> W<span class="fl">.22</span></span></code></pre></div>
<p>We generate <span class="math inline">\(n=1000\)</span> states, each from an AR(1) model.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="chmvdlm.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123457</span>)</span>
<span id="cb326-2"><a href="chmvdlm.html#cb326-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb326-3"><a href="chmvdlm.html#cb326-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ar =</span> phi<span class="fl">.1</span>),</span>
<span id="cb326-4"><a href="chmvdlm.html#cb326-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">sd =</span> <span class="fu">sqrt</span>(W<span class="fl">.11</span>))</span>
<span id="cb326-5"><a href="chmvdlm.html#cb326-5" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ar =</span> phi<span class="fl">.2</span>),</span>
<span id="cb326-6"><a href="chmvdlm.html#cb326-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">sd =</span> <span class="fu">sqrt</span>(W<span class="fl">.22</span>))</span></code></pre></div>
<p>Next, we generate <span class="math inline">\(N(\boldsymbol{0},\boldsymbol{V})\)</span> observation errors, and create the bivariate time series <span class="math inline">\(\boldsymbol{y}_t\)</span>.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="chmvdlm.html#cb327-1" aria-hidden="true" tabindex="-1"></a>err.v <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(n, <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">sigma =</span> V)</span>
<span id="cb327-2"><a href="chmvdlm.html#cb327-2" aria-hidden="true" tabindex="-1"></a>err.v1 <span class="ot">&lt;-</span> err.v[, <span class="dv">1</span>]</span>
<span id="cb327-3"><a href="chmvdlm.html#cb327-3" aria-hidden="true" tabindex="-1"></a>err.v2 <span class="ot">&lt;-</span> err.v[, <span class="dv">2</span>]</span>
<span id="cb327-4"><a href="chmvdlm.html#cb327-4" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> err.v1</span>
<span id="cb327-5"><a href="chmvdlm.html#cb327-5" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> x2 <span class="sc">+</span> err.v2</span>
<span id="cb327-6"><a href="chmvdlm.html#cb327-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(y1, y2)</span></code></pre></div>
<p>The CCF between <span class="math inline">\(y_{1,t}\)</span> and <span class="math inline">\(y_{2,t}\)</span> shows a non-zero value at lag <span class="math inline">\(0\)</span>; see Figure <a href="chmvdlm.html#fig:Biv-ts-2">12.1</a>.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="chmvdlm.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(y1,y2, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),<span class="at">ylab=</span><span class="st">&quot;ccf&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;lag&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:Biv-ts-2"></span>
<img src="gitbook_version_files/figure-html/Biv-ts-2-1.png" alt="Sample CCF of the simulated Gaussian bivariate responses with diagonal $\boldsymbol{W}$ and $\boldsymbol{\Phi}$." width="672" />
<p class="caption">
FIGURE 12.1: Sample CCF of the simulated Gaussian bivariate responses with diagonal <span class="math inline">\(\boldsymbol{W}\)</span> and <span class="math inline">\(\boldsymbol{\Phi}\)</span>.
</p>
</div>
<p>We show the formula for <a href="chmvdlm.html#eq:vec-obs-sim">(12.3)</a>, which involves setting up indexes
<code>id.V</code>, <code>id.b0.x1</code>, and <code>id.b0.x2</code>.
Since <code>R-INLA</code> would fit a univariate Gaussian model by default, we must indicate
the requirement for a bivariate Gaussian model (i.e., <span class="math inline">\(q=2\)</span>) by setting <code>model="iid2d"</code> in the formula chunk for . That is, the term
<code>f(id.V, model = "iid2d", n = N)</code> indicates that <span class="math inline">\(\boldsymbol V\)</span> is assumed to be a non-diagonal covariance matrix for the bivariate responses, and follows an inverse Wishart prior.</p>
<p>In <code>R-INLA</code>, “iid2d” is represented internally as a single vector of length <span class="math inline">\(N=2n\)</span>, i.e.,
<span class="math inline">\((y_{1,1},\ldots, y_{1,n}, y_{2,1},\ldots, y_{2,n})\)</span>;
<span class="math inline">\(N\)</span> is a required argument in the functional form for .
Since <code>R-INLA</code> only allows us to specify up to <span class="math inline">\(q=5\)</span>, the maximum allowed value of <span class="math inline">\(N\)</span> is <span class="math inline">\(N=5n\)</span>, and we can correspondingly set up
model = “iid5d”. For more details, refer to <code>inla.doc("iid")</code>.</p>
<p>The terms <code>f(id.b0.x1, model = "ar1")</code> and
<code>f(id.b0.x2, model = "ar1")</code> indicate how to fit independent AR(1) models to each of the state variables, which are independent because we assumed both
<span class="math inline">\(\boldsymbol \Phi\)</span> and <span class="math inline">\(\boldsymbol W\)</span> to be diagonal matrices.
We assume a Gaussian prior with high precision through the argument <code>control.family</code> (recall that <code>control.family</code> is used to define priors on the distribution of the response variable). We can verify from the results that the estimated values are close to the corresponding true values used in the simulation. The estimated level <span class="math inline">\(\alpha\)</span> is close to zero (posterior mean is <span class="math inline">\(-0.059\)</span> and posterior standard deviation is <span class="math inline">\(0.053\)</span>), since we did not include a level in the simulated model.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="chmvdlm.html#cb329-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> n <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb329-2"><a href="chmvdlm.html#cb329-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> n</span>
<span id="cb329-3"><a href="chmvdlm.html#cb329-3" aria-hidden="true" tabindex="-1"></a>id.V <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb329-4"><a href="chmvdlm.html#cb329-4" aria-hidden="true" tabindex="-1"></a>id.b0.x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb329-5"><a href="chmvdlm.html#cb329-5" aria-hidden="true" tabindex="-1"></a>id.b0.x2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb329-6"><a href="chmvdlm.html#cb329-6" aria-hidden="true" tabindex="-1"></a>biv.dat <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(y, id.b0.x1, id.b0.x2, id.V)</span></code></pre></div>
<p>The formula and model fit are shown below.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="chmvdlm.html#cb330-1" aria-hidden="true" tabindex="-1"></a>formula.biv <span class="ot">&lt;-</span>  y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb330-2"><a href="chmvdlm.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.V, <span class="at">model =</span> <span class="st">&quot;iid2d&quot;</span>, <span class="at">n =</span> N) <span class="sc">+</span></span>
<span id="cb330-3"><a href="chmvdlm.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.b0.x1, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>) <span class="sc">+</span></span>
<span id="cb330-4"><a href="chmvdlm.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.b0.x2, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="chmvdlm.html#cb331-1" aria-hidden="true" tabindex="-1"></a>result.biv <span class="ot">&lt;-</span> <span class="fu">inla</span>(</span>
<span id="cb331-2"><a href="chmvdlm.html#cb331-2" aria-hidden="true" tabindex="-1"></a>  formula.biv,</span>
<span id="cb331-3"><a href="chmvdlm.html#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>),</span>
<span id="cb331-4"><a href="chmvdlm.html#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> biv.dat,</span>
<span id="cb331-5"><a href="chmvdlm.html#cb331-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.inla =</span> <span class="fu">list</span>(<span class="at">h =</span> <span class="fl">1e-5</span>, <span class="at">tolerance =</span> <span class="fl">1e-3</span>),</span>
<span id="cb331-6"><a href="chmvdlm.html#cb331-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb331-7"><a href="chmvdlm.html#cb331-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb331-8"><a href="chmvdlm.html#cb331-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb331-9"><a href="chmvdlm.html#cb331-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial =</span> <span class="dv">12</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span></span>
<span id="cb331-10"><a href="chmvdlm.html#cb331-10" aria-hidden="true" tabindex="-1"></a>  )))</span>
<span id="cb331-11"><a href="chmvdlm.html#cb331-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb331-12"><a href="chmvdlm.html#cb331-12" aria-hidden="true" tabindex="-1"></a>result.biv.summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(result.biv)</span></code></pre></div>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="chmvdlm.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format.inla.out</span>(result.biv.summary<span class="sc">$</span>hyperpar[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb332-2"><a href="chmvdlm.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                           mean  sd   </span></span>
<span id="cb332-3"><a href="chmvdlm.html#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Precision for id.V component 1 1.072 0.045</span></span>
<span id="cb332-4"><a href="chmvdlm.html#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Precision for id.V component 2 0.686 0.027</span></span>
<span id="cb332-5"><a href="chmvdlm.html#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Rho1:2 for id.V                0.635 0.015</span></span>
<span id="cb332-6"><a href="chmvdlm.html#cb332-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Precision for id.b0.x1         0.758 0.097</span></span>
<span id="cb332-7"><a href="chmvdlm.html#cb332-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Rho for id.b0.x1               0.767 0.016</span></span>
<span id="cb332-8"><a href="chmvdlm.html#cb332-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Precision for id.b0.x2         4.287 0.980</span></span>
<span id="cb332-9"><a href="chmvdlm.html#cb332-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Rho for id.b0.x2               0.587 0.060</span></span></code></pre></div>
<p>In the hyperparameter summary,
<code>Precision for id.V (component 1)</code> estimates the precision <span class="math inline">\(1/V_{11}\)</span>,
<code>Precision for id.V (component 2)</code> estimates the precision <span class="math inline">\(1/V_{22}\)</span>, and
<code>Rho1:2 for id.V</code> estimates the correlation <span class="math inline">\(R_{12}\)</span>. The estimates of the precisions for the state errors are given by <code>Precision for id.b0.x1</code> and <code>Precision for id.b0.x2</code>, while the estimates for <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span> are given by
<code>Rho for id.b0.x1</code> and <code>Rho for id.b0.x2</code>.</p>
</div>
<div id="tnctaxi-onezone" class="section level3 hasAnchor" number="12.2.3">
<h3><span class="header-section-number">12.2.3</span> Example: Ridesourcing data in NYC for a single taxi zone<a href="chmvdlm.html#tnctaxi-onezone" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We reconsider the ridesourcing data in NYC that we discussed in Chapter <a href="chapter6.html#chapter6">6</a>, where we treated scaled weekly TNC usage as a response variable and scaled Subway and Taxi usage as predictors, along with other time and location varying predictors. We now illustrate the multivariate DLM fit by treating scaled TNC and Taxi usage as a <span class="math inline">\(q=2\)</span>-dimensional <em>response vector</em> and fit the model shown in <a href="chmvdlm.html#eq:vec-obs">(12.1)</a> and <a href="chmvdlm.html#eq:vec-st">(12.2)</a> to data from a single taxi zone, i.e., Brooklyn Heights.
The CCF plot for TNC usage and Taxi usage in Figure <a href="chmvdlm.html#fig:CCF-tnctaxi">12.2</a> shows significant negative correlation up to nearly <span class="math inline">\(20\)</span> lags, with some evidence of nonstationary behavior.</p>
<!--

-->
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="chmvdlm.html#cb333-1" aria-hidden="true" tabindex="-1"></a>ride.brooklyn <span class="ot">&lt;-</span></span>
<span id="cb333-2"><a href="chmvdlm.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">&quot;ride.brooklyn.csv&quot;</span>,</span>
<span id="cb333-3"><a href="chmvdlm.html#cb333-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb333-4"><a href="chmvdlm.html#cb333-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb333-5"><a href="chmvdlm.html#cb333-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(ride.brooklyn<span class="sc">$</span>date)</span>
<span id="cb333-6"><a href="chmvdlm.html#cb333-6" aria-hidden="true" tabindex="-1"></a>n.hold <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb333-7"><a href="chmvdlm.html#cb333-7" aria-hidden="true" tabindex="-1"></a>n.train <span class="ot">&lt;-</span> n <span class="sc">-</span> n.hold</span>
<span id="cb333-8"><a href="chmvdlm.html#cb333-8" aria-hidden="true" tabindex="-1"></a>train.df <span class="ot">&lt;-</span> ride.brooklyn[<span class="dv">1</span><span class="sc">:</span>n.train, ]</span>
<span id="cb333-9"><a href="chmvdlm.html#cb333-9" aria-hidden="true" tabindex="-1"></a>test.df <span class="ot">&lt;-</span> <span class="fu">tail</span>(ride.brooklyn, n.hold)</span></code></pre></div>
<p>We construct a vectorized form of the bivariate response time series. <span class="math inline">\(N = 2n\)</span> represents the length of the <span class="math inline">\(2\)</span>-dimensional time series (i.e., <span class="math inline">\(q=2\)</span>) stacked one below the other, and the response vector <span class="math inline">\(\boldsymbol y\)</span> is the stacked time series consisting of scaled TNC and Taxi usage.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="chmvdlm.html#cb334-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> n</span>
<span id="cb334-2"><a href="chmvdlm.html#cb334-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span></span>
<span id="cb334-3"><a href="chmvdlm.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">c</span>(train.df<span class="sc">$</span>tnc, <span class="fu">rep</span>(<span class="cn">NA</span>, n.hold)), <span class="fu">c</span>(train.df<span class="sc">$</span>taxi, <span class="fu">rep</span>(<span class="cn">NA</span>, n.hold)))</span></code></pre></div>
<div class="figure"><span id="fig:CCF-tnctaxi"></span>
<img src="gitbook_version_files/figure-html/CCF-tnctaxi-1.png" alt="Sample CCF plot of TNC usage and Taxi usage." width="672" />
<p class="caption">
FIGURE 12.2: Sample CCF plot of TNC usage and Taxi usage.
</p>
</div>
<p>We include Subway usage,
holiday, and precipitation (these were described in Chapter <a href="chapter6.html#chapter6">6</a>)
as exogenous variables with fixed effects (similar to the best fitting models in Chapter <a href="chapter6.html#chapter6">6</a>). Since <span class="math inline">\(q=2\)</span>, we construct two new variables for each predictor, one for each response. For example, to understand the impact of subway on TNC and Taxi usage, the new set of predictors is <em>subway.tnc</em> and <em>subway.taxi</em>. In <em>subway.tnc</em>, the last <span class="math inline">\(n\)</span> values are NA’s since the last <span class="math inline">\(n\)</span> values in <span class="math inline">\(\boldsymbol y\)</span> correspond to data for
scaled Taxi usage. Likewise, the first <span class="math inline">\(n\)</span> values of <em>subway.taxi</em> are set as NA.
In a similar fashion, we create indexes for the level, holidays, and precipitation.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="chmvdlm.html#cb335-1" aria-hidden="true" tabindex="-1"></a>alpha.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,n), <span class="fu">rep</span>(<span class="cn">NA</span>,n))</span>
<span id="cb335-2"><a href="chmvdlm.html#cb335-2" aria-hidden="true" tabindex="-1"></a>alpha.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,n), <span class="fu">rep</span>(<span class="dv">1</span>,n))</span>
<span id="cb335-3"><a href="chmvdlm.html#cb335-3" aria-hidden="true" tabindex="-1"></a>subway.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(ride.brooklyn<span class="sc">$</span>subway, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb335-4"><a href="chmvdlm.html#cb335-4" aria-hidden="true" tabindex="-1"></a>subway.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), ride.brooklyn<span class="sc">$</span>subway)</span>
<span id="cb335-5"><a href="chmvdlm.html#cb335-5" aria-hidden="true" tabindex="-1"></a>holidays.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(ride.brooklyn<span class="sc">$</span>holidays, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb335-6"><a href="chmvdlm.html#cb335-6" aria-hidden="true" tabindex="-1"></a>holidays.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), ride.brooklyn<span class="sc">$</span>holidays)</span>
<span id="cb335-7"><a href="chmvdlm.html#cb335-7" aria-hidden="true" tabindex="-1"></a>precip.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(ride.brooklyn<span class="sc">$</span>precip, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb335-8"><a href="chmvdlm.html#cb335-8" aria-hidden="true" tabindex="-1"></a>precip.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), ride.brooklyn<span class="sc">$</span>precip)</span>
<span id="cb335-9"><a href="chmvdlm.html#cb335-9" aria-hidden="true" tabindex="-1"></a>t.index <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb335-10"><a href="chmvdlm.html#cb335-10" aria-hidden="true" tabindex="-1"></a>b0.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb335-11"><a href="chmvdlm.html#cb335-11" aria-hidden="true" tabindex="-1"></a>b0.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), <span class="dv">1</span><span class="sc">:</span>n)</span></code></pre></div>
<p>We then create a data frame as:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="chmvdlm.html#cb336-1" aria-hidden="true" tabindex="-1"></a>ride.mvn.data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(y, alpha.tnc, alpha.taxi,</span>
<span id="cb336-2"><a href="chmvdlm.html#cb336-2" aria-hidden="true" tabindex="-1"></a>                                  subway.tnc, subway.taxi,</span>
<span id="cb336-3"><a href="chmvdlm.html#cb336-3" aria-hidden="true" tabindex="-1"></a>                                  holidays.tnc, holidays.taxi,</span>
<span id="cb336-4"><a href="chmvdlm.html#cb336-4" aria-hidden="true" tabindex="-1"></a>                                  precip.tnc, precip.taxi,</span>
<span id="cb336-5"><a href="chmvdlm.html#cb336-5" aria-hidden="true" tabindex="-1"></a>                                  b0.tnc, b0.taxi,</span>
<span id="cb336-6"><a href="chmvdlm.html#cb336-6" aria-hidden="true" tabindex="-1"></a>                                  t.index)</span></code></pre></div>
<p>We fit a model to <span class="math inline">\(\boldsymbol y_t\)</span> (consisting of time series of TNC and Taxi usage) as a function of a dynamic trend <span class="math inline">\(\boldsymbol{\beta}_{t,0}\)</span> and static effects due to Subway usage (<span class="math inline">\(Z_{t,1}\)</span>), holidays (<span class="math inline">\(Z_{t,2}\)</span>), and precipitation (<span class="math inline">\(Z_{t,3}\)</span>). The observation equations are</p>
<p><span class="math display" id="eq:tnctaxi-vec-obs">\[\begin{align}
Y_{1,t} = \alpha_1 + \beta_{1,t,0} + \beta_{1,1} Z_{t,1} + \beta_{1,2} Z_{t,2} +
\beta_{1,3} Z_{t,3} + v_{1,t}, \notag \\
Y_{2,t} = \alpha_2 + \beta_{2,t,0} + \beta_{2,1} Z_{t,1} + \beta_{2,2} Z_{t,2} +
\beta_{2,3} Z_{t,3} + v_{2,t},  \tag{12.4}
\end{align}\]</span>
where the observation error vector <span class="math inline">\(\boldsymbol{v}_t \sim N(\boldsymbol 0, \boldsymbol V)\)</span> with <span class="math inline">\(\boldsymbol V\)</span> being a <span class="math inline">\(2 \times 2\)</span> p.d. covariance matrix.
The state equation corresponding to the latent vector
<span class="math inline">\(\boldsymbol{\beta}_{t,0} = (\beta_{1,t,0}, \beta_{2,t,0})&#39;\)</span> is</p>
<p><span class="math display" id="eq:tnctaxi-vec-st">\[\begin{align}
\boldsymbol{\beta}_{t,0} = \boldsymbol{\Phi} \boldsymbol{\beta}_{t-1,0} +  \boldsymbol w_t,
\tag{12.5}
\end{align}\]</span>
where <span class="math inline">\(\boldsymbol w_t \sim N(\boldsymbol 0, \boldsymbol W)\)</span>, and
<span class="math inline">\(\boldsymbol W\)</span> and <span class="math inline">\(\boldsymbol{\Phi}\)</span> are diagonal. This corresponds to <span class="math inline">\(q=2\)</span> independent AR(1) processes.</p>
<p>We indicate the bivariate Gaussian assumption on <span class="math inline">\(\boldsymbol V\)</span> by setting <code>model="iid2d"</code> in the formula chunk for <em>t.index</em>.
We also assume a Gaussian prior with high precision through the argument <code>control.family</code>, which is necessary in <code>R-INLA</code> for fitting MV models.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="chmvdlm.html#cb337-1" aria-hidden="true" tabindex="-1"></a>formula.ride.mvn.model1 <span class="ot">&lt;-</span>  y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> alpha.tnc <span class="sc">+</span> alpha.taxi <span class="sc">+</span></span>
<span id="cb337-2"><a href="chmvdlm.html#cb337-2" aria-hidden="true" tabindex="-1"></a>   subway.tnc <span class="sc">+</span> subway.taxi <span class="sc">+</span> </span>
<span id="cb337-3"><a href="chmvdlm.html#cb337-3" aria-hidden="true" tabindex="-1"></a>   holidays.tnc <span class="sc">+</span> holidays.taxi <span class="sc">+</span></span>
<span id="cb337-4"><a href="chmvdlm.html#cb337-4" aria-hidden="true" tabindex="-1"></a>   precip.tnc <span class="sc">+</span> precip.taxi <span class="sc">+</span></span>
<span id="cb337-5"><a href="chmvdlm.html#cb337-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(t.index, <span class="at">model=</span><span class="st">&quot;iid2d&quot;</span>, <span class="at">n=</span>N) <span class="sc">+</span></span>
<span id="cb337-6"><a href="chmvdlm.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(b0.tnc,<span class="at">model=</span><span class="st">&quot;ar1&quot;</span>) <span class="sc">+</span></span>
<span id="cb337-7"><a href="chmvdlm.html#cb337-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(b0.taxi,<span class="at">model=</span><span class="st">&quot;ar1&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="chmvdlm.html#cb338-1" aria-hidden="true" tabindex="-1"></a>ride.mvn.model1 <span class="ot">&lt;-</span></span>
<span id="cb338-2"><a href="chmvdlm.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inla</span>(</span>
<span id="cb338-3"><a href="chmvdlm.html#cb338-3" aria-hidden="true" tabindex="-1"></a>    formula.ride.mvn.model1,</span>
<span id="cb338-4"><a href="chmvdlm.html#cb338-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>),</span>
<span id="cb338-5"><a href="chmvdlm.html#cb338-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ride.mvn.data,</span>
<span id="cb338-6"><a href="chmvdlm.html#cb338-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb338-7"><a href="chmvdlm.html#cb338-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb338-8"><a href="chmvdlm.html#cb338-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb338-9"><a href="chmvdlm.html#cb338-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.family =</span></span>
<span id="cb338-10"><a href="chmvdlm.html#cb338-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb338-11"><a href="chmvdlm.html#cb338-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">initial =</span> <span class="dv">10</span>,</span>
<span id="cb338-12"><a href="chmvdlm.html#cb338-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="cn">TRUE</span></span>
<span id="cb338-13"><a href="chmvdlm.html#cb338-13" aria-hidden="true" tabindex="-1"></a>      ))),</span>
<span id="cb338-14"><a href="chmvdlm.html#cb338-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb338-15"><a href="chmvdlm.html#cb338-15" aria-hidden="true" tabindex="-1"></a><span class="fu">format.inla.out</span>(ride.mvn.model1<span class="sc">$</span>summary.hyperpar[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb338-16"><a href="chmvdlm.html#cb338-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                              mean    sd     </span></span>
<span id="cb338-17"><a href="chmvdlm.html#cb338-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Precision for t.index component 1  91.193  12.230</span></span>
<span id="cb338-18"><a href="chmvdlm.html#cb338-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Precision for t.index component 2  83.942  11.335</span></span>
<span id="cb338-19"><a href="chmvdlm.html#cb338-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Rho1:2 for t.index                  0.088   0.093</span></span>
<span id="cb338-20"><a href="chmvdlm.html#cb338-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Precision for b0.tnc               12.692   7.334</span></span>
<span id="cb338-21"><a href="chmvdlm.html#cb338-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Rho for b0.tnc                      0.995   0.003</span></span>
<span id="cb338-22"><a href="chmvdlm.html#cb338-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Precision for b0.taxi             263.293 163.829</span></span>
<span id="cb338-23"><a href="chmvdlm.html#cb338-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Rho for b0.taxi                     0.956   0.029</span></span></code></pre></div>
<p>In the hyperparameter summary,
<code>Precision for t.index (component 1)</code> estimates the precision for TNC, <span class="math inline">\(1/V_{11}\)</span>,
<code>Precision for t.index (component 2)</code> estimates the precision for Taxi, <span class="math inline">\(1/V_{22}\)</span>, and <code>Rho1:2 for t.index</code> estimates the correlation between <span class="math inline">\(R_{12}\)</span>, which is not significant.
The estimates of the precisions for the state errors are given by <code>Precision for b0.tnc</code> and <code>Precision for b0.taxi</code>, while the estimates for <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span> are given by
<code>Rho for b0.tnc</code> and <code>Rho for b0.taxi</code>.</p>
<p><strong>Fitted values and forecasts in multivariate DLMs</strong></p>
<p>The steps used to obtain fitted values in the multivariate framework are different from what we presented in Chapter <a href="chapter3.html#chapter3">3</a> for the univariate case. We can adopt two different coding approaches to obtain fitted values in the multivariate case. The first approach uses <code>inla.posterior.samples()</code> to construct samples of the predictive distributions of the responses. The second approach uses <code>inla.make.lincomb()</code> and then fits the model.</p>
<p><strong>Approach 1.</strong></p>
<p>Recall that <code>inla.posterior.samples()</code> provides <span class="math inline">\(M\)</span> (a user chosen number; here, <span class="math inline">\(M=1000\)</span>) posterior samples for the model parameters and hyperparameters. For each <span class="math inline">\(m=1,\ldots,M\)</span>, we can use these posterior values to <em>simulate fitted responses</em> from the model structure in <a href="chmvdlm.html#eq:tnctaxi-vec-obs">(12.4)</a> and <a href="chmvdlm.html#eq:tnctaxi-vec-st">(12.5)</a>. For each of the <span class="math inline">\(q=2\)</span> components, the sample average of these <span class="math inline">\(M\)</span> fitted response values for each time <span class="math inline">\(t\)</span> constitutes a fitted time series, which can then be plotted against the observed TNC and Taxi usages, as shown in Figure <a href="chmvdlm.html#fig:tnc-taxi-fit-post-sample">12.3</a>.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="chmvdlm.html#cb339-1" aria-hidden="true" tabindex="-1"></a>post.sample <span class="ot">&lt;-</span></span>
<span id="cb339-2"><a href="chmvdlm.html#cb339-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inla.posterior.sample</span>(<span class="dv">1000</span>, ride.mvn.model1)</span></code></pre></div>
<p>We source the function below which computes the fitted values based on the model formula given the posterior samples.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="chmvdlm.html#cb340-1" aria-hidden="true" tabindex="-1"></a>fit.post.sample <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb340-2"><a href="chmvdlm.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  sigma2.v1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> x<span class="sc">$</span>hyperpar[<span class="dv">1</span>]</span>
<span id="cb340-3"><a href="chmvdlm.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  sigma2.v2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> x<span class="sc">$</span>hyperpar[<span class="dv">2</span>]</span>
<span id="cb340-4"><a href="chmvdlm.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  rho.v1v2 <span class="ot">&lt;-</span> x<span class="sc">$</span>hyperpar[<span class="dv">3</span>]</span>
<span id="cb340-5"><a href="chmvdlm.html#cb340-5" aria-hidden="true" tabindex="-1"></a>  cov.v1v2 <span class="ot">&lt;-</span> rho.v1v2 <span class="sc">*</span> <span class="fu">sqrt</span>(sigma2.v1) <span class="sc">*</span> <span class="fu">sqrt</span>(sigma2.v2)</span>
<span id="cb340-6"><a href="chmvdlm.html#cb340-6" aria-hidden="true" tabindex="-1"></a>  sigma.v <span class="ot">&lt;-</span></span>
<span id="cb340-7"><a href="chmvdlm.html#cb340-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(<span class="fu">c</span>(sigma2.v1, cov.v1v2, cov.v1v2, sigma2.v2), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb340-8"><a href="chmvdlm.html#cb340-8" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(n, <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">sigma =</span> sigma.v)</span>
<span id="cb340-9"><a href="chmvdlm.html#cb340-9" aria-hidden="true" tabindex="-1"></a>  V1 <span class="ot">&lt;-</span> V[, <span class="dv">1</span>]</span>
<span id="cb340-10"><a href="chmvdlm.html#cb340-10" aria-hidden="true" tabindex="-1"></a>  V2 <span class="ot">&lt;-</span> V[, <span class="dv">2</span>]</span>
<span id="cb340-11"><a href="chmvdlm.html#cb340-11" aria-hidden="true" tabindex="-1"></a>  fit.tnc <span class="ot">&lt;-</span> x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;alpha.tnc&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">+</span></span>
<span id="cb340-12"><a href="chmvdlm.html#cb340-12" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;b0.tnc&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">+</span></span>
<span id="cb340-13"><a href="chmvdlm.html#cb340-13" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;subway.tnc&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-14"><a href="chmvdlm.html#cb340-14" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>subway <span class="sc">+</span></span>
<span id="cb340-15"><a href="chmvdlm.html#cb340-15" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;holidays.tnc&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-16"><a href="chmvdlm.html#cb340-16" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>holidays <span class="sc">+</span></span>
<span id="cb340-17"><a href="chmvdlm.html#cb340-17" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;precip.tnc&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-18"><a href="chmvdlm.html#cb340-18" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>precip <span class="sc">+</span></span>
<span id="cb340-19"><a href="chmvdlm.html#cb340-19" aria-hidden="true" tabindex="-1"></a>    V1</span>
<span id="cb340-20"><a href="chmvdlm.html#cb340-20" aria-hidden="true" tabindex="-1"></a>  fit.taxi <span class="ot">&lt;-</span> x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;alpha.taxi&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">+</span></span>
<span id="cb340-21"><a href="chmvdlm.html#cb340-21" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;b0.taxi&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">+</span></span>
<span id="cb340-22"><a href="chmvdlm.html#cb340-22" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;subway.taxi&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-23"><a href="chmvdlm.html#cb340-23" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>subway <span class="sc">+</span></span>
<span id="cb340-24"><a href="chmvdlm.html#cb340-24" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;holidays.taxi&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-25"><a href="chmvdlm.html#cb340-25" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>holidays <span class="sc">+</span></span>
<span id="cb340-26"><a href="chmvdlm.html#cb340-26" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>latent[<span class="fu">grep</span>(<span class="st">&quot;precip.taxi&quot;</span>, <span class="fu">rownames</span>(x<span class="sc">$</span>latent))] <span class="sc">*</span> </span>
<span id="cb340-27"><a href="chmvdlm.html#cb340-27" aria-hidden="true" tabindex="-1"></a>    ride.brooklyn<span class="sc">$</span>precip <span class="sc">+</span></span>
<span id="cb340-28"><a href="chmvdlm.html#cb340-28" aria-hidden="true" tabindex="-1"></a>    V2</span>
<span id="cb340-29"><a href="chmvdlm.html#cb340-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">fit.tnc =</span> fit.tnc, <span class="at">fit.taxi =</span> fit.taxi))</span>
<span id="cb340-30"><a href="chmvdlm.html#cb340-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The fitted values for TNC usage and Taxi usage can be obtained for each set of generated parameters, and the averages over <span class="math inline">\(M=1000\)</span> samples are saved as <em>tnc.fit</em> and <em>taxi.fit</em>.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="chmvdlm.html#cb341-1" aria-hidden="true" tabindex="-1"></a>fits <span class="ot">&lt;-</span> post.sample <span class="sc">%&gt;%</span></span>
<span id="cb341-2"><a href="chmvdlm.html#cb341-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x)</span>
<span id="cb341-3"><a href="chmvdlm.html#cb341-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit.post.sample</span>(x))</span>
<span id="cb341-4"><a href="chmvdlm.html#cb341-4" aria-hidden="true" tabindex="-1"></a>tnc.fit <span class="ot">&lt;-</span> fits <span class="sc">%&gt;%</span></span>
<span id="cb341-5"><a href="chmvdlm.html#cb341-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="cf">function</span>(x)</span>
<span id="cb341-6"><a href="chmvdlm.html#cb341-6" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>fit.tnc) <span class="sc">%&gt;%</span> </span>
<span id="cb341-7"><a href="chmvdlm.html#cb341-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowMeans</span>()</span>
<span id="cb341-8"><a href="chmvdlm.html#cb341-8" aria-hidden="true" tabindex="-1"></a>taxi.fit <span class="ot">&lt;-</span> fits <span class="sc">%&gt;%</span></span>
<span id="cb341-9"><a href="chmvdlm.html#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="cf">function</span>(x)</span>
<span id="cb341-10"><a href="chmvdlm.html#cb341-10" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>fit.taxi) <span class="sc">%&gt;%</span> </span>
<span id="cb341-11"><a href="chmvdlm.html#cb341-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowMeans</span>()</span></code></pre></div>
<p>Figure <a href="chmvdlm.html#fig:tnc-taxi-fit-post-sample">12.3</a> shows the fitted versus observed values for TNC usage (top plot) and Taxi usage (bottom plot). The model fit is close for most of the training period. While the forecasts for Taxi usage in the test period are accurate, the model seems to under predict actual TNC usage which appears to have an upswing for those time periods.</p>
<div class="figure"><span id="fig:tnc-taxi-fit-post-sample"></span>
<img src="gitbook_version_files/figure-html/tnc-taxi-fit-post-sample-1.png" alt="Observed (red) versus fitted (blue) TNC (top panel) and Taxi usage (bottom panel). Fits obtained using `inla.posterior.sample()`. The black vertical line divides the data into training and test portions." width="672" />
<p class="caption">
FIGURE 12.3: Observed (red) versus fitted (blue) TNC (top panel) and Taxi usage (bottom panel). Fits obtained using <code>inla.posterior.sample()</code>. The black vertical line divides the data into training and test portions.
</p>
</div>
<p><strong>Approach 2.</strong></p>
<p>We set up and use linear combinations of the latent random field (for details, see <span class="citation">Martins et al. (<a href="#ref-martins2013bayesian" role="doc-biblioref">2013</a>)</span>). Specifically, for model fitting and prediction, we use <code>inla.make.lincomb()</code>, which creates a list for every <span class="math inline">\(t\)</span> with <em>idx</em> and <em>weight</em>, where <em>weight</em> is the value of the predictor corresponding to the time index <em>idx</em>. The setup for TNC is shown below.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="chmvdlm.html#cb342-1" aria-hidden="true" tabindex="-1"></a>lc1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb342-2"><a href="chmvdlm.html#cb342-2" aria-hidden="true" tabindex="-1"></a>tnc.dat.lc <span class="ot">&lt;-</span> ride.brooklyn <span class="sc">%&gt;%</span> </span>
<span id="cb342-3"><a href="chmvdlm.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subway, holidays<span class="sc">:</span>precip)</span>
<span id="cb342-4"><a href="chmvdlm.html#cb342-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb342-5"><a href="chmvdlm.html#cb342-5" aria-hidden="true" tabindex="-1"></a>  idx0 <span class="ot">&lt;-</span> idx1 <span class="ot">&lt;-</span> idx2 <span class="ot">&lt;-</span> idx3 <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">0</span>,n)</span>
<span id="cb342-6"><a href="chmvdlm.html#cb342-6" aria-hidden="true" tabindex="-1"></a>  idx0[i] <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb342-7"><a href="chmvdlm.html#cb342-7" aria-hidden="true" tabindex="-1"></a>  idx1[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">1</span>]</span>
<span id="cb342-8"><a href="chmvdlm.html#cb342-8" aria-hidden="true" tabindex="-1"></a>  idx2[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">2</span>]</span>
<span id="cb342-9"><a href="chmvdlm.html#cb342-9" aria-hidden="true" tabindex="-1"></a>  idx3[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">3</span>]</span>
<span id="cb342-10"><a href="chmvdlm.html#cb342-10" aria-hidden="true" tabindex="-1"></a>  lcc <span class="ot">&lt;-</span>  <span class="fu">inla.make.lincomb</span>(<span class="at">alpha.tnc=</span><span class="dv">1</span>, <span class="at">b0.tnc =</span> idx0, <span class="at">subway.tnc=</span>idx1[i],  </span>
<span id="cb342-11"><a href="chmvdlm.html#cb342-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">holidays.tnc =</span> idx2[i], <span class="at">precip.tnc =</span> idx3[i])</span>
<span id="cb342-12"><a href="chmvdlm.html#cb342-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lcc[[<span class="dv">1</span>]])) {</span>
<span id="cb342-13"><a href="chmvdlm.html#cb342-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb342-14"><a href="chmvdlm.html#cb342-14" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>idx <span class="ot">&lt;-</span> i</span>
<span id="cb342-15"><a href="chmvdlm.html#cb342-15" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb342-16"><a href="chmvdlm.html#cb342-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb342-17"><a href="chmvdlm.html#cb342-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb342-18"><a href="chmvdlm.html#cb342-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lcc) <span class="ot">&lt;-</span>  <span class="fu">paste0</span>(<span class="st">&quot;tnc&quot;</span>, i)</span>
<span id="cb342-19"><a href="chmvdlm.html#cb342-19" aria-hidden="true" tabindex="-1"></a>  lc1 <span class="ot">&lt;-</span>  <span class="fu">c</span>(lc1, lcc)</span>
<span id="cb342-20"><a href="chmvdlm.html#cb342-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The setup for Taxi usage is similar.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="chmvdlm.html#cb343-1" aria-hidden="true" tabindex="-1"></a>lc2 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb343-2"><a href="chmvdlm.html#cb343-2" aria-hidden="true" tabindex="-1"></a>taxi.dat.lc <span class="ot">&lt;-</span> ride.brooklyn <span class="sc">%&gt;%</span></span>
<span id="cb343-3"><a href="chmvdlm.html#cb343-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subway, holidays<span class="sc">:</span>precip)</span>
<span id="cb343-4"><a href="chmvdlm.html#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb343-5"><a href="chmvdlm.html#cb343-5" aria-hidden="true" tabindex="-1"></a>  idx0 <span class="ot">&lt;-</span> idx1 <span class="ot">&lt;-</span> idx2 <span class="ot">&lt;-</span> idx3 <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb343-6"><a href="chmvdlm.html#cb343-6" aria-hidden="true" tabindex="-1"></a>  idx0[i] <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb343-7"><a href="chmvdlm.html#cb343-7" aria-hidden="true" tabindex="-1"></a>  idx1[i] <span class="ot">&lt;-</span> taxi.dat.lc[i, <span class="dv">1</span>]</span>
<span id="cb343-8"><a href="chmvdlm.html#cb343-8" aria-hidden="true" tabindex="-1"></a>  idx2[i] <span class="ot">&lt;-</span> taxi.dat.lc[i, <span class="dv">2</span>]</span>
<span id="cb343-9"><a href="chmvdlm.html#cb343-9" aria-hidden="true" tabindex="-1"></a>  idx3[i] <span class="ot">&lt;-</span> taxi.dat.lc[i, <span class="dv">3</span>]</span>
<span id="cb343-10"><a href="chmvdlm.html#cb343-10" aria-hidden="true" tabindex="-1"></a>  lcc <span class="ot">&lt;-</span></span>
<span id="cb343-11"><a href="chmvdlm.html#cb343-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inla.make.lincomb</span>(</span>
<span id="cb343-12"><a href="chmvdlm.html#cb343-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha.taxi =</span> <span class="dv">1</span>,</span>
<span id="cb343-13"><a href="chmvdlm.html#cb343-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">b0.taxi =</span> idx0,</span>
<span id="cb343-14"><a href="chmvdlm.html#cb343-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">subway.taxi =</span> idx1[i],</span>
<span id="cb343-15"><a href="chmvdlm.html#cb343-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">holidays.taxi =</span> idx2[i],</span>
<span id="cb343-16"><a href="chmvdlm.html#cb343-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">precip.taxi =</span> idx3[i]</span>
<span id="cb343-17"><a href="chmvdlm.html#cb343-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb343-18"><a href="chmvdlm.html#cb343-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lcc[[<span class="dv">1</span>]])) {</span>
<span id="cb343-19"><a href="chmvdlm.html#cb343-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb343-20"><a href="chmvdlm.html#cb343-20" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>idx <span class="ot">&lt;-</span> i</span>
<span id="cb343-21"><a href="chmvdlm.html#cb343-21" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb343-22"><a href="chmvdlm.html#cb343-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb343-23"><a href="chmvdlm.html#cb343-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb343-24"><a href="chmvdlm.html#cb343-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lcc) <span class="ot">&lt;-</span>  <span class="fu">paste0</span>(<span class="st">&quot;taxi&quot;</span>, i)</span>
<span id="cb343-25"><a href="chmvdlm.html#cb343-25" aria-hidden="true" tabindex="-1"></a>  lc2 <span class="ot">&lt;-</span>  <span class="fu">c</span>(lc2, lcc)</span>
<span id="cb343-26"><a href="chmvdlm.html#cb343-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We then combine the linear combinations into <em>lc</em> as follows.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="chmvdlm.html#cb344-1" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">c</span>(lc1, lc2)</span></code></pre></div>
<p>The list <em>lcc</em> contains the index number (time), the values for fixed
predictors, and latent intercepts <span class="math inline">\(\beta_{1,t,0}\)</span> and <span class="math inline">\(\beta_{2,t,0}\)</span>. For example, the components of lc1[[5]] will show values of the predictors at time <span class="math inline">\(t = 5\)</span>:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="chmvdlm.html#cb345-1" aria-hidden="true" tabindex="-1"></a>lc1[[<span class="dv">5</span>]]</span></code></pre></div>
<p>We include the list of linear combinations created in our model fitting using the argument <code>lincomb = lc</code> in the <code>inla()</code> call. This enables us to obtain posterior marginals of the linear combinations, as shown below. Also note that the model output will not include a “Precision for Gaussian observation” term, due to our assumption of a large and fixed precision.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="chmvdlm.html#cb346-1" aria-hidden="true" tabindex="-1"></a>ride.mvn.model1 <span class="ot">&lt;-</span></span>
<span id="cb346-2"><a href="chmvdlm.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inla</span>(</span>
<span id="cb346-3"><a href="chmvdlm.html#cb346-3" aria-hidden="true" tabindex="-1"></a>    formula.ride.mvn.model1,</span>
<span id="cb346-4"><a href="chmvdlm.html#cb346-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>),</span>
<span id="cb346-5"><a href="chmvdlm.html#cb346-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ride.mvn.data,</span>
<span id="cb346-6"><a href="chmvdlm.html#cb346-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-7"><a href="chmvdlm.html#cb346-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb346-8"><a href="chmvdlm.html#cb346-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.family =</span></span>
<span id="cb346-9"><a href="chmvdlm.html#cb346-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb346-10"><a href="chmvdlm.html#cb346-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">initial =</span> <span class="dv">10</span>,</span>
<span id="cb346-11"><a href="chmvdlm.html#cb346-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">fixed =</span> <span class="cn">TRUE</span></span>
<span id="cb346-12"><a href="chmvdlm.html#cb346-12" aria-hidden="true" tabindex="-1"></a>      ))),</span>
<span id="cb346-13"><a href="chmvdlm.html#cb346-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lincomb =</span> lc</span>
<span id="cb346-14"><a href="chmvdlm.html#cb346-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb346-15"><a href="chmvdlm.html#cb346-15" aria-hidden="true" tabindex="-1"></a><span class="fu">format.inla.out</span>(ride.mvn.model1<span class="sc">$</span>summary.hyperpar[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)])</span>
<span id="cb346-16"><a href="chmvdlm.html#cb346-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                              mean    sd     </span></span>
<span id="cb346-17"><a href="chmvdlm.html#cb346-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Precision for t.index component 1  91.191  12.230</span></span>
<span id="cb346-18"><a href="chmvdlm.html#cb346-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Precision for t.index component 2  83.942  11.335</span></span>
<span id="cb346-19"><a href="chmvdlm.html#cb346-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Rho1:2 for t.index                  0.088   0.093</span></span>
<span id="cb346-20"><a href="chmvdlm.html#cb346-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Precision for b0.tnc               12.751   7.364</span></span>
<span id="cb346-21"><a href="chmvdlm.html#cb346-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Rho for b0.tnc                      0.994   0.003</span></span>
<span id="cb346-22"><a href="chmvdlm.html#cb346-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Precision for b0.taxi             263.984 164.728</span></span>
<span id="cb346-23"><a href="chmvdlm.html#cb346-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Rho for b0.taxi                     0.956   0.029</span></span></code></pre></div>
<p>Plots of fitted versus observed usage for TNC and Taxi usage are shown in Figure <a href="chmvdlm.html#fig:tnc-taxi-fit">12.4</a>.</p>
<div class="figure"><span id="fig:tnc-taxi-fit"></span>
<img src="gitbook_version_files/figure-html/tnc-taxi-fit-1.png" alt="Observed (red) versus fitted (blue) TNC usage (top panel) and Taxi usage (bottom panel). Fits obtained using `inla.make.lincomb()`. The black vertical line divides the data into training and test portions." width="672" />
<p class="caption">
FIGURE 12.4: Observed (red) versus fitted (blue) TNC usage (top panel) and Taxi usage (bottom panel). Fits obtained using <code>inla.make.lincomb()</code>. The black vertical line divides the data into training and test portions.
</p>
</div>
<p>We end this section with a few useful remarks.</p>
<p><strong>Remark 1.</strong>
If we wish to modify the inverse Wishart prior specification, we can use the code given below.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="chmvdlm.html#cb347-1" aria-hidden="true" tabindex="-1"></a>formula.ride.mvn.model1 <span class="ot">&lt;-</span>  y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb347-2"><a href="chmvdlm.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(t.index,</span>
<span id="cb347-3"><a href="chmvdlm.html#cb347-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;iid2d&quot;</span>,</span>
<span id="cb347-4"><a href="chmvdlm.html#cb347-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> N,</span>
<span id="cb347-5"><a href="chmvdlm.html#cb347-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">theta1 =</span> <span class="fu">list</span>(<span class="at">param =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span>, <span class="dv">0</span>)))) <span class="sc">+</span> ...</span></code></pre></div>
<p>We see that differences due to the different prior specifications are minimal for large <span class="math inline">\(n\)</span>.</p>
<p><strong>Remark 2.</strong>
If we wish to include the effects of the exogenous predictors as dynamic <em>random effects</em>, rather than fixed effects as shown above, the following code is useful. Setting up the linear combinations is similar to the fixed effects case; the only change is that we replace the name of the predictor by its index. For example, we replace <em>subway.tnc</em> (which contains data on Subway usage for the first <span class="math inline">\(n\)</span> rows and NA’s for the next <span class="math inline">\(n\)</span> rows) with <em>id.sub.tnc</em> (which is a vector with <span class="math inline">\(1:n\)</span> followed by <span class="math inline">\(n\)</span> NA’s). The variables <em>subway.taxi</em> and <em>id.sub.taxi</em> will have the Subway usage data or <span class="math inline">\(1:n\)</span> switched with the NA’s.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="chmvdlm.html#cb348-1" aria-hidden="true" tabindex="-1"></a>t.index <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb348-2"><a href="chmvdlm.html#cb348-2" aria-hidden="true" tabindex="-1"></a>alpha.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,n), <span class="fu">rep</span>(<span class="cn">NA</span>,n))</span>
<span id="cb348-3"><a href="chmvdlm.html#cb348-3" aria-hidden="true" tabindex="-1"></a>alpha.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,n), <span class="fu">rep</span>(<span class="dv">1</span>,n))</span>
<span id="cb348-4"><a href="chmvdlm.html#cb348-4" aria-hidden="true" tabindex="-1"></a>b0.tnc <span class="ot">&lt;-</span> id.sub.tnc <span class="ot">&lt;-</span></span>
<span id="cb348-5"><a href="chmvdlm.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  id.holidays.tnc <span class="ot">&lt;-</span> id.precip.tnc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">rep</span>(<span class="cn">NA</span>, n))</span>
<span id="cb348-6"><a href="chmvdlm.html#cb348-6" aria-hidden="true" tabindex="-1"></a>b0.taxi <span class="ot">&lt;-</span> id.sub.taxi <span class="ot">&lt;-</span> id.events.taxi <span class="ot">&lt;-</span></span>
<span id="cb348-7"><a href="chmvdlm.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  id.holidays.taxi <span class="ot">&lt;-</span> id.precip.taxi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">NA</span>, n), <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb348-8"><a href="chmvdlm.html#cb348-8" aria-hidden="true" tabindex="-1"></a>ride.mvn.data <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(</span>
<span id="cb348-9"><a href="chmvdlm.html#cb348-9" aria-hidden="true" tabindex="-1"></a>  y,alpha.tnc,alpha.taxi,subway.tnc,subway.taxi,holidays.tnc,</span>
<span id="cb348-10"><a href="chmvdlm.html#cb348-10" aria-hidden="true" tabindex="-1"></a>  holidays.taxi,precip.tnc,precip.taxi,</span>
<span id="cb348-11"><a href="chmvdlm.html#cb348-11" aria-hidden="true" tabindex="-1"></a>  b0.tnc,b0.taxi,id.sub.tnc,</span>
<span id="cb348-12"><a href="chmvdlm.html#cb348-12" aria-hidden="true" tabindex="-1"></a>  id.sub.taxi,id.holidays.tnc,id.holidays.taxi,</span>
<span id="cb348-13"><a href="chmvdlm.html#cb348-13" aria-hidden="true" tabindex="-1"></a>  id.precip.tnc,id.precip.taxi,t.index</span>
<span id="cb348-14"><a href="chmvdlm.html#cb348-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In the formula, we then replace the fixed effects by suitable random effect specifications as shown below.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="chmvdlm.html#cb349-1" aria-hidden="true" tabindex="-1"></a>formula.ride.mvn.model1 <span class="ot">&lt;-</span>  y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> alpha.tnc <span class="sc">+</span> alpha.taxi <span class="sc">+</span></span>
<span id="cb349-2"><a href="chmvdlm.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(t.index, <span class="at">model =</span> <span class="st">&quot;iid2d&quot;</span>, <span class="at">n =</span> N) <span class="sc">+</span></span>
<span id="cb349-3"><a href="chmvdlm.html#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(b0.tnc, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>, <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-4"><a href="chmvdlm.html#cb349-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(b0.taxi, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>, <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-5"><a href="chmvdlm.html#cb349-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.sub.tnc, subway.tnc, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>, <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-6"><a href="chmvdlm.html#cb349-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.sub.taxi, subway.taxi, <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>, <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-7"><a href="chmvdlm.html#cb349-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.holidays.tnc,</span>
<span id="cb349-8"><a href="chmvdlm.html#cb349-8" aria-hidden="true" tabindex="-1"></a>    holidays.tnc,</span>
<span id="cb349-9"><a href="chmvdlm.html#cb349-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>,</span>
<span id="cb349-10"><a href="chmvdlm.html#cb349-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-11"><a href="chmvdlm.html#cb349-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.holidays.taxi,</span>
<span id="cb349-12"><a href="chmvdlm.html#cb349-12" aria-hidden="true" tabindex="-1"></a>    holidays.taxi,</span>
<span id="cb349-13"><a href="chmvdlm.html#cb349-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>,</span>
<span id="cb349-14"><a href="chmvdlm.html#cb349-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-15"><a href="chmvdlm.html#cb349-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.precip.tnc,</span>
<span id="cb349-16"><a href="chmvdlm.html#cb349-16" aria-hidden="true" tabindex="-1"></a>    precip.tnc,</span>
<span id="cb349-17"><a href="chmvdlm.html#cb349-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>,</span>
<span id="cb349-18"><a href="chmvdlm.html#cb349-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb349-19"><a href="chmvdlm.html#cb349-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.precip.taxi,</span>
<span id="cb349-20"><a href="chmvdlm.html#cb349-20" aria-hidden="true" tabindex="-1"></a>    precip.taxi,</span>
<span id="cb349-21"><a href="chmvdlm.html#cb349-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;ar1&quot;</span>,</span>
<span id="cb349-22"><a href="chmvdlm.html#cb349-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">constr =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Corresponding linear combinations can then be similarly constructed, as shown below for TNC usage. The construction for Taxi usage will be similar.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="chmvdlm.html#cb350-1" aria-hidden="true" tabindex="-1"></a>lc1 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb350-2"><a href="chmvdlm.html#cb350-2" aria-hidden="true" tabindex="-1"></a>tnc.dat.lc <span class="ot">&lt;-</span> ride.brooklyn <span class="sc">%&gt;%</span> </span>
<span id="cb350-3"><a href="chmvdlm.html#cb350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subway, holidays<span class="sc">:</span>precip)</span>
<span id="cb350-4"><a href="chmvdlm.html#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb350-5"><a href="chmvdlm.html#cb350-5" aria-hidden="true" tabindex="-1"></a>  idx0 <span class="ot">&lt;-</span> idx1 <span class="ot">&lt;-</span> idx2 <span class="ot">&lt;-</span> idx3 <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">0</span>,n)</span>
<span id="cb350-6"><a href="chmvdlm.html#cb350-6" aria-hidden="true" tabindex="-1"></a>  idx0[i] <span class="ot">&lt;-</span>  <span class="dv">1</span></span>
<span id="cb350-7"><a href="chmvdlm.html#cb350-7" aria-hidden="true" tabindex="-1"></a>  idx1[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">1</span>]</span>
<span id="cb350-8"><a href="chmvdlm.html#cb350-8" aria-hidden="true" tabindex="-1"></a>  idx2[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">2</span>]</span>
<span id="cb350-9"><a href="chmvdlm.html#cb350-9" aria-hidden="true" tabindex="-1"></a>  idx3[i] <span class="ot">&lt;-</span> tnc.dat.lc[i,<span class="dv">3</span>]</span>
<span id="cb350-10"><a href="chmvdlm.html#cb350-10" aria-hidden="true" tabindex="-1"></a>  lcc <span class="ot">&lt;-</span>  <span class="fu">inla.make.lincomb</span>(<span class="at">b0.tnc=</span>idx0, <span class="at">id.sub.tnc=</span>idx1,  </span>
<span id="cb350-11"><a href="chmvdlm.html#cb350-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">id.holidays.tnc =</span> idx2, <span class="at">id.precip.tnc =</span> idx3)</span>
<span id="cb350-12"><a href="chmvdlm.html#cb350-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lcc[[<span class="dv">1</span>]])) {</span>
<span id="cb350-13"><a href="chmvdlm.html#cb350-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb350-14"><a href="chmvdlm.html#cb350-14" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>idx <span class="ot">&lt;-</span> i</span>
<span id="cb350-15"><a href="chmvdlm.html#cb350-15" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb350-16"><a href="chmvdlm.html#cb350-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb350-17"><a href="chmvdlm.html#cb350-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb350-18"><a href="chmvdlm.html#cb350-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lcc) <span class="ot">&lt;-</span>  <span class="fu">paste0</span>(<span class="st">&quot;tnc&quot;</span>, i)</span>
<span id="cb350-19"><a href="chmvdlm.html#cb350-19" aria-hidden="true" tabindex="-1"></a>  lc1 <span class="ot">&lt;-</span>  <span class="fu">c</span>(lc1, lcc)</span>
<span id="cb350-20"><a href="chmvdlm.html#cb350-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!--
#Taxi
taxi.dat.lc <- ride.brooklyn %>% 
  select(subway, holidays:precip)
for(i in 1:n){
  idx0 <- idx1 <- idx2 <- idx3 <-  rep(0,n)
  idx0[i] <-  1
  idx1[i] <- taxi.dat.lc[i,1]
  idx2[i] <- taxi.dat.lc[i,2]
  idx3[i] <- taxi.dat.lc[i,3]
  lcc <-  inla.make.lincomb(b0.taxi=idx0, id.sub.taxi=idx1, 
                            id.holidays.taxi = idx2, id.precip.taxi = idx3)
  
  for (k in 1:length(lcc[[1]])) {
    if(length(lcc[[1]][[k]][[1]]$weight)==0){
      lcc[[1]][[k]][[1]]$idx <- i
      lcc[[1]][[k]][[1]]$weight <- 0
    }
  }
  names(lcc) <-  paste0("taxi", i)
  lc2 <-  c(lc2, lcc)
}
lc <- c(lc1, lc2)
-->
<p><strong>Remark 3.</strong>
Note that the current version of the function <code>inla.make.lincomb()</code> gives an error when a predictor value is <span class="math inline">\(0\)</span> (for example, in holidays or precipitation), the reason being that a <em>weight=0</em> corresponding to this <span class="math inline">\(0\)</span> value has now been coded as NA in <code>R-INLA</code>.<a href="resources.html#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a> To circumvent this, we include a workaround by the following lines of code which replace <em>weight = NA</em> by <em>weight=0</em>:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="chmvdlm.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lcc[[<span class="dv">1</span>]])) {</span>
<span id="cb351-2"><a href="chmvdlm.html#cb351-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight)<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb351-3"><a href="chmvdlm.html#cb351-3" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>idx <span class="ot">&lt;-</span> i</span>
<span id="cb351-4"><a href="chmvdlm.html#cb351-4" aria-hidden="true" tabindex="-1"></a>      lcc[[<span class="dv">1</span>]][[k]][[<span class="dv">1</span>]]<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb351-5"><a href="chmvdlm.html#cb351-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb351-6"><a href="chmvdlm.html#cb351-6" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
</div>
<div id="MVICCWPhi" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Model with equicorrelated <span class="math inline">\(\boldsymbol{w}_t\)</span> and diagonal <span class="math inline">\(\boldsymbol \Phi\)</span><a href="chmvdlm.html#MVICCWPhi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let <span class="math inline">\(\boldsymbol \Phi\)</span> be diagonal, while
<span class="math inline">\(Cov(\boldsymbol{w}_t) = \boldsymbol W = \sigma^2_w [(1-\rho_w)\boldsymbol I + \rho_w \boldsymbol J]\)</span>, where <span class="math inline">\(\boldsymbol I\)</span> is the <span class="math inline">\(p \times p\)</span> identity matrix and <span class="math inline">\(\boldsymbol J\)</span> is the <span class="math inline">\(p \times p\)</span> matrix whose entries are all 1. That is,
components of the state error vector <span class="math inline">\(\boldsymbol w_t\)</span> are correlated, such that the correlation between any pair of components is the same
<span class="math inline">\(|\rho_w| &lt; 1\)</span> (intra-class correlation or equi-correlation structure). We model simulated trivariate Gaussian time series with this structure using the <em>group</em> option.</p>
<div id="simtrivar1" class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Example: Simulated trivariate series<a href="chmvdlm.html#simtrivar1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We simulate a trivariate series <span class="math inline">\(\boldsymbol{y}_t\)</span>. The observation error covariance
<span class="math inline">\(\boldsymbol{V}\)</span> is set up below.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="chmvdlm.html#cb352-1" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fl">1.0</span> </span>
<span id="cb352-2"><a href="chmvdlm.html#cb352-2" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.22</span> <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb352-3"><a href="chmvdlm.html#cb352-3" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.33</span> <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb352-4"><a href="chmvdlm.html#cb352-4" aria-hidden="true" tabindex="-1"></a>R<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb352-5"><a href="chmvdlm.html#cb352-5" aria-hidden="true" tabindex="-1"></a>R<span class="fl">.13</span> <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb352-6"><a href="chmvdlm.html#cb352-6" aria-hidden="true" tabindex="-1"></a>R<span class="fl">.23</span> <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb352-7"><a href="chmvdlm.html#cb352-7" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.12</span> <span class="ot">&lt;-</span> R<span class="fl">.12</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.11</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.22</span>)</span>
<span id="cb352-8"><a href="chmvdlm.html#cb352-8" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.13</span> <span class="ot">&lt;-</span> R<span class="fl">.13</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.11</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.33</span>)</span>
<span id="cb352-9"><a href="chmvdlm.html#cb352-9" aria-hidden="true" tabindex="-1"></a>V<span class="fl">.23</span> <span class="ot">&lt;-</span> R<span class="fl">.23</span> <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.22</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(V<span class="fl">.33</span>)</span>
<span id="cb352-10"><a href="chmvdlm.html#cb352-10" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(V<span class="fl">.11</span>, V<span class="fl">.12</span>, V<span class="fl">.13</span>, V<span class="fl">.12</span>, V<span class="fl">.22</span>, V<span class="fl">.23</span>,</span>
<span id="cb352-11"><a href="chmvdlm.html#cb352-11" aria-hidden="true" tabindex="-1"></a>              V<span class="fl">.13</span>, V<span class="fl">.23</span>, V<span class="fl">.33</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>The state error covariance <span class="math inline">\(\boldsymbol{W}\)</span> has the equicorrelation structure.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="chmvdlm.html#cb353-1" aria-hidden="true" tabindex="-1"></a>sig2.w <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb353-2"><a href="chmvdlm.html#cb353-2" aria-hidden="true" tabindex="-1"></a>rho.w <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb353-3"><a href="chmvdlm.html#cb353-3" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.11</span> <span class="ot">&lt;-</span> sig2.w</span>
<span id="cb353-4"><a href="chmvdlm.html#cb353-4" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.22</span> <span class="ot">&lt;-</span> sig2.w</span>
<span id="cb353-5"><a href="chmvdlm.html#cb353-5" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.33</span> <span class="ot">&lt;-</span> sig2.w</span>
<span id="cb353-6"><a href="chmvdlm.html#cb353-6" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.12</span> <span class="ot">&lt;-</span> sig2.w<span class="sc">*</span>rho.w</span>
<span id="cb353-7"><a href="chmvdlm.html#cb353-7" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.13</span> <span class="ot">&lt;-</span> sig2.w<span class="sc">*</span>rho.w</span>
<span id="cb353-8"><a href="chmvdlm.html#cb353-8" aria-hidden="true" tabindex="-1"></a>W<span class="fl">.23</span> <span class="ot">&lt;-</span> sig2.w<span class="sc">*</span>rho.w</span>
<span id="cb353-9"><a href="chmvdlm.html#cb353-9" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(W<span class="fl">.11</span>, W<span class="fl">.12</span>, W<span class="fl">.13</span>, W<span class="fl">.12</span>, W<span class="fl">.22</span>, W<span class="fl">.23</span>,</span>
<span id="cb353-10"><a href="chmvdlm.html#cb353-10" aria-hidden="true" tabindex="-1"></a>              W<span class="fl">.13</span>, W<span class="fl">.23</span>, W<span class="fl">.33</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>We assume that each AR(1) coefficient has the same value <span class="math inline">\(\phi\)</span>. We then set up the
arrays <span class="math inline">\(\boldsymbol{I}_3\)</span> and diag<span class="math inline">\((\phi_1, \phi_2, \phi_3)\)</span> to be fed as parameters in the <code>marima.sim()</code> function in the R package . Note that the <span class="math inline">\(\phi\)</span> value in this package corresponds to the AR polynomial <span class="math inline">\((1+ \phi B)\)</span> and not <span class="math inline">\((1 - \phi B)\)</span>, which is the usual convention.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="chmvdlm.html#cb354-1" aria-hidden="true" tabindex="-1"></a>phi<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb354-2"><a href="chmvdlm.html#cb354-2" aria-hidden="true" tabindex="-1"></a>phi<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb354-3"><a href="chmvdlm.html#cb354-3" aria-hidden="true" tabindex="-1"></a>phi<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb354-4"><a href="chmvdlm.html#cb354-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up Phi as be a 3-dim array</span></span>
<span id="cb354-5"><a href="chmvdlm.html#cb354-5" aria-hidden="true" tabindex="-1"></a>Phi <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb354-6"><a href="chmvdlm.html#cb354-6" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb354-7"><a href="chmvdlm.html#cb354-7" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb354-8"><a href="chmvdlm.html#cb354-8" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">1.0</span></span>
<span id="cb354-9"><a href="chmvdlm.html#cb354-9" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> phi<span class="fl">.1</span></span>
<span id="cb354-10"><a href="chmvdlm.html#cb354-10" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> phi<span class="fl">.2</span></span>
<span id="cb354-11"><a href="chmvdlm.html#cb354-11" aria-hidden="true" tabindex="-1"></a>Phi[<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> phi<span class="fl">.3</span> </span></code></pre></div>
<p>We simulate the states from VAR(1) processes using the package.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="chmvdlm.html#cb355-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> n.sim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb355-2"><a href="chmvdlm.html#cb355-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb355-3"><a href="chmvdlm.html#cb355-3" aria-hidden="true" tabindex="-1"></a>n.start <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb355-4"><a href="chmvdlm.html#cb355-4" aria-hidden="true" tabindex="-1"></a>avg <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb355-5"><a href="chmvdlm.html#cb355-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span></span>
<span id="cb355-6"><a href="chmvdlm.html#cb355-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">marima.sim</span>(</span>
<span id="cb355-7"><a href="chmvdlm.html#cb355-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>,</span>
<span id="cb355-8"><a href="chmvdlm.html#cb355-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ar.model =</span> Phi,</span>
<span id="cb355-9"><a href="chmvdlm.html#cb355-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ar.dif =</span> <span class="cn">NULL</span>,</span>
<span id="cb355-10"><a href="chmvdlm.html#cb355-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ma.model =</span> <span class="cn">NULL</span>,</span>
<span id="cb355-11"><a href="chmvdlm.html#cb355-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">averages =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb355-12"><a href="chmvdlm.html#cb355-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid.cov =</span> W,</span>
<span id="cb355-13"><a href="chmvdlm.html#cb355-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb355-14"><a href="chmvdlm.html#cb355-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">nstart =</span> n.start,</span>
<span id="cb355-15"><a href="chmvdlm.html#cb355-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">nsim =</span> n.sim</span>
<span id="cb355-16"><a href="chmvdlm.html#cb355-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb355-17"><a href="chmvdlm.html#cb355-17" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> X[, <span class="dv">1</span>]</span>
<span id="cb355-18"><a href="chmvdlm.html#cb355-18" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> X[, <span class="dv">2</span>]</span>
<span id="cb355-19"><a href="chmvdlm.html#cb355-19" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> X[, <span class="dv">3</span>]</span></code></pre></div>
<p>Figure <a href="chmvdlm.html#fig:Trivx-acf">12.5</a> shows the ACF plots for the three state vector components, with <span class="math inline">\(\phi = -0.5\)</span>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="chmvdlm.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb356-2"><a href="chmvdlm.html#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(x1, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;ACF of x1&quot;</span>)</span>
<span id="cb356-3"><a href="chmvdlm.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(x2, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;ACF of x2&quot;</span>)</span>
<span id="cb356-4"><a href="chmvdlm.html#cb356-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(x3, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;ACF of x3&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:Trivx-acf"></span>
<img src="gitbook_version_files/figure-html/Trivx-acf-1.png" alt="ACF's of the trivariate state series ($\phi = -0.5$)." width="672" />
<p class="caption">
FIGURE 12.5: ACF’s of the trivariate state series (<span class="math inline">\(\phi = -0.5\)</span>).
</p>
</div>
<p>We next simulate observation errors from a <span class="math inline">\(N_3(\boldsymbol{0}, \boldsymbol{V})\)</span>
distribution, and add these to the states to get the response time series <span class="math inline">\(\boldsymbol{y}_t\)</span>.
Figure <a href="chmvdlm.html#fig:Triv-ccf">12.6</a> shows the CCF of <span class="math inline">\(\boldsymbol{x}_t\)</span> (top row), and the CCF of <span class="math inline">\(\boldsymbol{y}_t\)</span> (bottom row).</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="chmvdlm.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate observation errors</span></span>
<span id="cb357-2"><a href="chmvdlm.html#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123457</span>)</span>
<span id="cb357-3"><a href="chmvdlm.html#cb357-3" aria-hidden="true" tabindex="-1"></a>err.v <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(n.sim, <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">sigma =</span> V)</span>
<span id="cb357-4"><a href="chmvdlm.html#cb357-4" aria-hidden="true" tabindex="-1"></a>err.v1 <span class="ot">&lt;-</span> err.v[, <span class="dv">1</span>]</span>
<span id="cb357-5"><a href="chmvdlm.html#cb357-5" aria-hidden="true" tabindex="-1"></a>err.v2 <span class="ot">&lt;-</span> err.v[, <span class="dv">2</span>]</span>
<span id="cb357-6"><a href="chmvdlm.html#cb357-6" aria-hidden="true" tabindex="-1"></a>err.v3 <span class="ot">&lt;-</span> err.v[, <span class="dv">3</span>]</span>
<span id="cb357-7"><a href="chmvdlm.html#cb357-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add observation errors to states to get responses</span></span>
<span id="cb357-8"><a href="chmvdlm.html#cb357-8" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> x1 <span class="sc">+</span> err.v1</span>
<span id="cb357-9"><a href="chmvdlm.html#cb357-9" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> x2 <span class="sc">+</span> err.v2</span>
<span id="cb357-10"><a href="chmvdlm.html#cb357-10" aria-hidden="true" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> x3 <span class="sc">+</span> err.v3</span>
<span id="cb357-11"><a href="chmvdlm.html#cb357-11" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(y1, y2, y3)</span></code></pre></div>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="chmvdlm.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb358-2"><a href="chmvdlm.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(x1, x2, <span class="at">ylab =</span> <span class="st">&quot;CCF&quot;</span>, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (x1,x2)&quot;</span>)</span>
<span id="cb358-3"><a href="chmvdlm.html#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(x1, x3, <span class="at">ylab =</span> <span class="st">&quot;CCF&quot;</span>, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (x1,x3)&quot;</span>)</span>
<span id="cb358-4"><a href="chmvdlm.html#cb358-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(x2, x3, <span class="at">ylab =</span> <span class="st">&quot;CCF&quot;</span>, <span class="at">main =</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (x2,x3)&quot;</span>)</span>
<span id="cb358-5"><a href="chmvdlm.html#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(y1,y2, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (y1,y2)&quot;</span>)</span>
<span id="cb358-6"><a href="chmvdlm.html#cb358-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(y1,y3, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (y1,y3)&quot;</span>)</span>
<span id="cb358-7"><a href="chmvdlm.html#cb358-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ccf</span>(y2,y3, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">sub=</span><span class="st">&quot;CCF of (y2,y3)&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:Triv-ccf"></span>
<img src="gitbook_version_files/figure-html/Triv-ccf-1.png" alt="CCF's of the trivariate state and response time series." width="672" />
<p class="caption">
FIGURE 12.6: CCF’s of the trivariate state and response time series.
</p>
</div>
<p>The formula and model fit follow. Note that <code>id.b0.g &lt;- rep(1:3, each = n)</code> allows us to incorporate a grouping that reflects the equicorrelated state errors and the same <span class="math inline">\(\phi\)</span> in the the diagonal of <span class="math inline">\(\boldsymbol{\Phi}\)</span> in the
VAR<span class="math inline">\((1)\)</span> model for the state vector (dynamic intercept).
This is used in the
line <code>f(id.b0, model="ar1", constr = FALSE, group = id.b0.g)</code>. As in Section <a href="chmvdlm.html#MVDiagWPhi">12.2</a>, <code>f(id.V, model="iid3d", n=N)</code> allows a trivariate inverse Wishart specification for <span class="math inline">\(\boldsymbol V\)</span>.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="chmvdlm.html#cb359-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> n<span class="dv">-1</span></span>
<span id="cb359-2"><a href="chmvdlm.html#cb359-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">*</span>n</span>
<span id="cb359-3"><a href="chmvdlm.html#cb359-3" aria-hidden="true" tabindex="-1"></a>id.V <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb359-4"><a href="chmvdlm.html#cb359-4" aria-hidden="true" tabindex="-1"></a>id.b0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="dv">1</span><span class="sc">:</span>n, <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb359-5"><a href="chmvdlm.html#cb359-5" aria-hidden="true" tabindex="-1"></a>id.b0.g <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> n)</span>
<span id="cb359-6"><a href="chmvdlm.html#cb359-6" aria-hidden="true" tabindex="-1"></a>triv.dat <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(y, id.b0, id.b0.g, id.V)</span>
<span id="cb359-7"><a href="chmvdlm.html#cb359-7" aria-hidden="true" tabindex="-1"></a>formula.triv <span class="ot">&lt;-</span>  y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span>  </span>
<span id="cb359-8"><a href="chmvdlm.html#cb359-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.V, <span class="at">model=</span><span class="st">&quot;iid3d&quot;</span>, <span class="at">n=</span>N) <span class="sc">+</span></span>
<span id="cb359-9"><a href="chmvdlm.html#cb359-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(id.b0, <span class="at">model=</span><span class="st">&quot;ar1&quot;</span>, <span class="at">constr =</span> <span class="cn">FALSE</span>, <span class="at">group =</span> id.b0.g) </span></code></pre></div>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="chmvdlm.html#cb360-1" aria-hidden="true" tabindex="-1"></a>result.triv <span class="ot">&lt;-</span></span>
<span id="cb360-2"><a href="chmvdlm.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inla</span>(</span>
<span id="cb360-3"><a href="chmvdlm.html#cb360-3" aria-hidden="true" tabindex="-1"></a>    formula.triv,</span>
<span id="cb360-4"><a href="chmvdlm.html#cb360-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>),</span>
<span id="cb360-5"><a href="chmvdlm.html#cb360-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> triv.dat,</span>
<span id="cb360-6"><a href="chmvdlm.html#cb360-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.inla =</span> <span class="fu">list</span>(<span class="at">h =</span> <span class="fl">1e-5</span>, <span class="at">tolerance =</span> <span class="fl">1e-3</span>),</span>
<span id="cb360-7"><a href="chmvdlm.html#cb360-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb360-8"><a href="chmvdlm.html#cb360-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb360-9"><a href="chmvdlm.html#cb360-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb360-10"><a href="chmvdlm.html#cb360-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">initial =</span> <span class="dv">12</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span></span>
<span id="cb360-11"><a href="chmvdlm.html#cb360-11" aria-hidden="true" tabindex="-1"></a>    )))</span>
<span id="cb360-12"><a href="chmvdlm.html#cb360-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb360-13"><a href="chmvdlm.html#cb360-13" aria-hidden="true" tabindex="-1"></a>result.triv.summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(result.triv)</span></code></pre></div>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="chmvdlm.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format.inla.out</span>(result.triv.summary<span class="sc">$</span>hyperpar[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</span>
<span id="cb361-2"><a href="chmvdlm.html#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                           mean     sd       </span></span>
<span id="cb361-3"><a href="chmvdlm.html#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Precision for id.V component 1    0.958 2.700e-02</span></span>
<span id="cb361-4"><a href="chmvdlm.html#cb361-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Precision for id.V component 2    0.951 2.700e-02</span></span>
<span id="cb361-5"><a href="chmvdlm.html#cb361-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Precision for id.V component 3    0.860 2.800e-02</span></span>
<span id="cb361-6"><a href="chmvdlm.html#cb361-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Rho1:2 for id.V                   0.668 1.300e-02</span></span>
<span id="cb361-7"><a href="chmvdlm.html#cb361-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Rho1:3 for id.V                   0.453 1.900e-02</span></span>
<span id="cb361-8"><a href="chmvdlm.html#cb361-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Rho2:3 for id.V                   0.299 2.000e-02</span></span>
<span id="cb361-9"><a href="chmvdlm.html#cb361-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Precision for id.b0            1304.921 5.537e+16</span></span>
<span id="cb361-10"><a href="chmvdlm.html#cb361-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 8 Rho for id.b0                    -0.520 2.180e-01</span></span>
<span id="cb361-11"><a href="chmvdlm.html#cb361-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 9 GroupRho for id.b0                0.869 6.600e-02</span></span></code></pre></div>
<p>The first three rows in the output provide posterior summaries for the precisions of the components of <span class="math inline">\(\boldsymbol{v}_t\)</span>, whose true values are <span class="math inline">\(1.0\)</span>.
The next three rows are posterior summaries of the correlations between the components of
<span class="math inline">\(\boldsymbol{v}_t\)</span>, whose true values are <span class="math inline">\(R_{12}=0.7, R_{13}=0.4\)</span>, and <span class="math inline">\(R_{23}=0.25\)</span>.
The value <code>Rho for id.b0</code> estimates the common <span class="math inline">\(\phi\)</span>, with true value <span class="math inline">\(-0.5\)</span>.
The term <code>GroupRho for id.b0</code> estimates the equicorrelation coefficient <span class="math inline">\(\rho_w\)</span>, whose true value is <span class="math inline">\(0.75\)</span>. We can recover <span class="math inline">\(\sigma^2_w\)</span> by dividing <em>Precision for id.b0</em> by <span class="math inline">\(1-\phi^2\)</span>.
Again, to obtain fitted values and predictions, we can either use <code>inla.posterior.samples()</code> or <code>inla.make.lincomb()</code> (see the detailed discussion in Section <a href="chmvdlm.html#MVDiagWPhi">12.2</a>).</p>
</div>
</div>
<div id="rgenericmv" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Fitting multivariate models using <code>rgeneric</code><a href="chmvdlm.html#rgenericmv" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In vector time series modeling, we often need to fit models with a full (non-diagonal) <span class="math inline">\(\boldsymbol \Phi\)</span> matrix, and/or an unstructured state error covariance matrix <span class="math inline">\(\boldsymbol{W}\)</span>.
To the best of our knowledge, no <code>R-INLA</code> template currently exists for fitting such a model. Instead, we implement this by using the <code>rgeneric()</code> function.
<span class="citation">Gómez-Rubio (<a href="#ref-gomez2020bayesian" role="doc-biblioref">2020</a>)</span> used the <code>rgeneric()</code> function to fit a conditionally autoregressive (CAR) specification to latent spatial random effects, while <span class="citation">Palmı́-Perales, Gómez-Rubio, and Martinez-Beneito (<a href="#ref-palmi2019bayesian" role="doc-biblioref">2021</a>)</span> discussed multivariate spatial models for lattice data. For more details, see the example discussed in <code>vignette("rgeneric", package = INLA)</code>.</p>
<p>Here, we illustrate the use of the <code>rgeneric()</code> function for fitting a VAR(1) state equation (see <span class="citation">Dutta, Ravishanker, and Basu (<a href="#ref-duttaetal2022" role="doc-biblioref">2022</a>)</span> for more details).
<!-- It is useful to note the caution given on the `R-INLA` website that `rgeneric()` is an experimental function, and may be subject to changes.  -->
<!-- Note that, since the source code is fully written in `R`, the computational time may be high. -->
In using <code>rgeneric()</code>, the user directly computes the likelihood and priors that are required for the model specification of interest.
The function <code>inla.rgeneric.define()</code> defines the different latent effects, and takes as arguments functions such as <code>graph()</code>, <code>Q()</code>, etc., along with other arguments that are required to evaluate the different functions.</p>
<div id="simulgen" class="section level3 hasAnchor" number="12.4.1">
<h3><span class="header-section-number">12.4.1</span> Example: Simulated bivariate VAR(1) series<a href="chmvdlm.html#simulgen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We simulate bivariate time series from a model whose observation and state equations are given below:</p>
<p><span class="math display" id="eq:rgen">\[\begin{align}
\boldsymbol{y}_t &amp; = \boldsymbol{x}_t + \boldsymbol{v}_t,  \notag \\
\boldsymbol{x}_t &amp; = \boldsymbol{\Phi}\boldsymbol{x}_{t-1} + \boldsymbol{w}_t,   \tag{12.6}
\end{align}\]</span>
where <span class="math inline">\(\boldsymbol{v}_t \sim N(\boldsymbol{0}, \boldsymbol{V})\)</span> with
<span class="math inline">\(\boldsymbol{V} = \begin{pmatrix} 1/\tau_{11} &amp; R_{12}/\sqrt{\tau_{11}\tau_{22}} \\ R_{12}/\sqrt{\tau_{11}\tau_{22}} &amp; 1/\tau_{22} \end{pmatrix},\)</span>
<span class="math inline">\(\tau_{ii}\)</span> is the marginal precision of the <span class="math inline">\(i\)</span>th component of <span class="math inline">\(\boldsymbol{V}\)</span>, <span class="math inline">\(i=1,2\)</span>, and <span class="math inline">\(R_{12}\)</span> is the correlation between the two components of <span class="math inline">\(\boldsymbol{V}\)</span>. Here,
<span class="math inline">\(\boldsymbol{\Phi} = \begin{pmatrix}\phi_{11} &amp; \phi_{12} \\\phi_{21} &amp; \phi_{22} \end{pmatrix}\)</span>, and
<span class="math inline">\(\boldsymbol{W} = {\rm diag}(1/\tau_{w1}, 1/\tau_{w2})\)</span>,
<span class="math inline">\(\tau_{wi}\)</span> being the marginal precision of the <span class="math inline">\(i^{th}\)</span> component of <span class="math inline">\(\boldsymbol{w}_t\)</span>, <span class="math inline">\(i=1,2\)</span>.
<!--We estimate the parameter vector -->
Let <span class="math inline">\(\boldsymbol{\Theta} = (\phi_{11},\phi_{12},\phi_{21},\phi_{22},\tau_{w1},\tau_{w2},\tau_{11},\tau_{22},R_{12})&#39;\)</span>. The data is simulated using the code below and these true parameter values:</p>
<p><span class="math inline">\(\boldsymbol{\Phi} = \begin{pmatrix}0.7 &amp; 0.1 \\0.3 &amp; 0.2 \end{pmatrix}\)</span>,
<span class="math inline">\(\boldsymbol{V} = \begin{pmatrix}1/2 &amp; 0.55/\sqrt{2\times 3} \\0.55/\sqrt{2\times 3} &amp; 1/3 \end{pmatrix}\)</span>, and
<span class="math inline">\(\boldsymbol{W} = \begin{pmatrix}1/2 &amp; 0 \\0 &amp; 1/2 \end{pmatrix}\)</span>.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="chmvdlm.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123456</span>)</span>
<span id="cb362-2"><a href="chmvdlm.html#cb362-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb362-3"><a href="chmvdlm.html#cb362-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb362-4"><a href="chmvdlm.html#cb362-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb362-5"><a href="chmvdlm.html#cb362-5" aria-hidden="true" tabindex="-1"></a>phi.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.3</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>),<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>) </span>
<span id="cb362-6"><a href="chmvdlm.html#cb362-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct the W matrix</span></span>
<span id="cb362-7"><a href="chmvdlm.html#cb362-7" aria-hidden="true" tabindex="-1"></a>init.val <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb362-8"><a href="chmvdlm.html#cb362-8" aria-hidden="true" tabindex="-1"></a>rho.w1w2 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb362-9"><a href="chmvdlm.html#cb362-9" aria-hidden="true" tabindex="-1"></a>sigma2.w1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb362-10"><a href="chmvdlm.html#cb362-10" aria-hidden="true" tabindex="-1"></a>sigma2.w2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb362-11"><a href="chmvdlm.html#cb362-11" aria-hidden="true" tabindex="-1"></a>cov.w1w2 <span class="ot">&lt;-</span> rho.w1w2 <span class="sc">*</span> <span class="fu">sqrt</span>(sigma2.w1 <span class="sc">*</span> sigma2.w2)</span>
<span id="cb362-12"><a href="chmvdlm.html#cb362-12" aria-hidden="true" tabindex="-1"></a>sigma.mat.w <span class="ot">&lt;-</span></span>
<span id="cb362-13"><a href="chmvdlm.html#cb362-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(sigma2.w1, cov.w1w2, cov.w1w2, sigma2.w2),</span>
<span id="cb362-14"><a href="chmvdlm.html#cb362-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb362-15"><a href="chmvdlm.html#cb362-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="chmvdlm.html#cb363-1" aria-hidden="true" tabindex="-1"></a>sample.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb363-2"><a href="chmvdlm.html#cb363-2" aria-hidden="true" tabindex="-1"></a>sample.list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> init.val</span>
<span id="cb363-3"><a href="chmvdlm.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb363-4"><a href="chmvdlm.html#cb363-4" aria-hidden="true" tabindex="-1"></a>  sample.list[[i]] <span class="ot">&lt;-</span></span>
<span id="cb363-5"><a href="chmvdlm.html#cb363-5" aria-hidden="true" tabindex="-1"></a>    phi.mat <span class="sc">%*%</span> sample.list[[i <span class="sc">-</span> <span class="dv">1</span>]] <span class="sc">+</span> <span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(</span>
<span id="cb363-6"><a href="chmvdlm.html#cb363-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="dv">1</span>,</span>
<span id="cb363-7"><a href="chmvdlm.html#cb363-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb363-8"><a href="chmvdlm.html#cb363-8" aria-hidden="true" tabindex="-1"></a>      ,</span>
<span id="cb363-9"><a href="chmvdlm.html#cb363-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sigma =</span> sigma.mat.w</span>
<span id="cb363-10"><a href="chmvdlm.html#cb363-10" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb363-11"><a href="chmvdlm.html#cb363-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb363-12"><a href="chmvdlm.html#cb363-12" aria-hidden="true" tabindex="-1"></a>simulated_var <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, sample.list)</span>
<span id="cb363-13"><a href="chmvdlm.html#cb363-13" aria-hidden="true" tabindex="-1"></a>var.ts <span class="ot">&lt;-</span> <span class="fu">t</span>(simulated_var)</span>
<span id="cb363-14"><a href="chmvdlm.html#cb363-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(var.ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y1&quot;</span>, <span class="st">&quot;y2&quot;</span>)</span>
<span id="cb363-15"><a href="chmvdlm.html#cb363-15" aria-hidden="true" tabindex="-1"></a>x.t <span class="ot">&lt;-</span> <span class="fu">vec</span>(var.ts)</span></code></pre></div>
<p>We set up the true <span class="math inline">\(\boldsymbol{V}\)</span> matrix and simulate <span class="math inline">\(\boldsymbol{y}_t\)</span>.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="chmvdlm.html#cb364-1" aria-hidden="true" tabindex="-1"></a>rho.v1v2 <span class="ot">=</span> <span class="fl">0.55</span></span>
<span id="cb364-2"><a href="chmvdlm.html#cb364-2" aria-hidden="true" tabindex="-1"></a>sigma2.v1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb364-3"><a href="chmvdlm.html#cb364-3" aria-hidden="true" tabindex="-1"></a>sigma2.v2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb364-4"><a href="chmvdlm.html#cb364-4" aria-hidden="true" tabindex="-1"></a>cov.v1v2 <span class="ot">&lt;-</span> rho.v1v2 <span class="sc">*</span> <span class="fu">sqrt</span>(sigma2.v1 <span class="sc">*</span> sigma2.v2)</span>
<span id="cb364-5"><a href="chmvdlm.html#cb364-5" aria-hidden="true" tabindex="-1"></a>sigma.mat.v <span class="ot">&lt;-</span></span>
<span id="cb364-6"><a href="chmvdlm.html#cb364-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(sigma2.v1, cov.v1v2, cov.v1v2, sigma2.v2),</span>
<span id="cb364-7"><a href="chmvdlm.html#cb364-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb364-8"><a href="chmvdlm.html#cb364-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">byrow =</span> T)</span>
<span id="cb364-9"><a href="chmvdlm.html#cb364-9" aria-hidden="true" tabindex="-1"></a>v.t <span class="ot">&lt;-</span> <span class="fu">vec</span>(<span class="fu">mvrnorm</span>(n, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> sigma.mat.v))</span>
<span id="cb364-10"><a href="chmvdlm.html#cb364-10" aria-hidden="true" tabindex="-1"></a>y.t <span class="ot">&lt;-</span> x.t <span class="sc">+</span> v.t</span></code></pre></div>
<p>We next set up indexes and the data frame.</p>
<!-- ```{r, eval=FALSE, echo=FALSE} -->
<!-- utils::globalVariables(c("p", "k", "n")) -->
<!-- ``` -->
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="chmvdlm.html#cb365-1" aria-hidden="true" tabindex="-1"></a>inla.dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y.t, <span class="at">iid2d.id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(y.t))</span>
<span id="cb365-2"><a href="chmvdlm.html#cb365-2" aria-hidden="true" tabindex="-1"></a>odd.id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(inla.dat), <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb365-3"><a href="chmvdlm.html#cb365-3" aria-hidden="true" tabindex="-1"></a>even.id <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(inla.dat), <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb365-4"><a href="chmvdlm.html#cb365-4" aria-hidden="true" tabindex="-1"></a>var.id <span class="ot">&lt;-</span> <span class="fu">c</span>(odd.id, even.id)</span>
<span id="cb365-5"><a href="chmvdlm.html#cb365-5" aria-hidden="true" tabindex="-1"></a>inla.dat<span class="sc">$</span>var.id <span class="ot">&lt;-</span> var.id</span></code></pre></div>
<p>We source the function <code>inla.rgeneric.VAR_1()</code>, which is included in the list of custom functions, and is shown in Chapter <a href="resources.html#resources">14</a>.
Brief descriptions of the functions used within <code>inla.rgeneric.VAR_1()</code> are given below. For details on the formulas, see <span class="citation">Lütkepohl (<a href="#ref-lutkepohl2013" role="doc-biblioref">2013</a>)</span>, <span class="citation">Rue and Held (<a href="#ref-rue2005gaussian" role="doc-biblioref">2005</a>)</span>, and Chapter <a href="chmvdlm.html#chmvdlm">12</a> – Appendix.</p>
<ol style="list-style-type: decimal">
<li><code>graph()</code> defines which entries of a user defined precision matrix <code>Q()</code> are non-zero:</li>
</ol>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="chmvdlm.html#cb366-1" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb366-2"><a href="chmvdlm.html#cb366-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="fu">inla.as.sparse</span>(<span class="fu">Q</span>()))</span>
<span id="cb366-3"><a href="chmvdlm.html#cb366-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The precision matrix <span class="math inline">\(\boldsymbol{Q}(\boldsymbol{\theta})\)</span> is computed in sparse form by using the function <code>Q()</code>, with <code>param</code> denoting the model parameters:</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="chmvdlm.html#cb367-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb367-2"><a href="chmvdlm.html#cb367-2" aria-hidden="true" tabindex="-1"></a>  param <span class="ot">&lt;-</span> <span class="fu">interpret.theta</span>()</span>
<span id="cb367-3"><a href="chmvdlm.html#cb367-3" aria-hidden="true" tabindex="-1"></a>  phi.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(param<span class="sc">$</span>phi.vec, <span class="at">nrow =</span> k)</span>
<span id="cb367-4"><a href="chmvdlm.html#cb367-4" aria-hidden="true" tabindex="-1"></a>  sigma.w.inv <span class="ot">&lt;-</span> param<span class="sc">$</span>PREC</span>
<span id="cb367-5"><a href="chmvdlm.html#cb367-5" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">t</span>(phi.mat) <span class="sc">%*%</span> sigma.w.inv <span class="sc">%*%</span> phi.mat</span>
<span id="cb367-6"><a href="chmvdlm.html#cb367-6" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">t</span>(phi.mat) <span class="sc">%*%</span> sigma.w.inv</span>
<span id="cb367-7"><a href="chmvdlm.html#cb367-7" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> sigma.w.inv</span>
<span id="cb367-8"><a href="chmvdlm.html#cb367-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct mid-block</span></span>
<span id="cb367-9"><a href="chmvdlm.html#cb367-9" aria-hidden="true" tabindex="-1"></a>  zero.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span> <span class="sc">*</span> n)</span>
<span id="cb367-10"><a href="chmvdlm.html#cb367-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the matrix block</span></span>
<span id="cb367-11"><a href="chmvdlm.html#cb367-11" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">t</span>(B), A <span class="sc">+</span> C, B)</span>
<span id="cb367-12"><a href="chmvdlm.html#cb367-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initializing column id and matrix list</span></span>
<span id="cb367-13"><a href="chmvdlm.html#cb367-13" aria-hidden="true" tabindex="-1"></a>  col.id <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb367-14"><a href="chmvdlm.html#cb367-14" aria-hidden="true" tabindex="-1"></a>  mat.list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb367-15"><a href="chmvdlm.html#cb367-15" aria-hidden="true" tabindex="-1"></a>  col.id[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>(<span class="dv">3</span> <span class="sc">*</span> k)</span>
<span id="cb367-16"><a href="chmvdlm.html#cb367-16" aria-hidden="true" tabindex="-1"></a>  mat.list[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> zero.mat</span>
<span id="cb367-17"><a href="chmvdlm.html#cb367-17" aria-hidden="true" tabindex="-1"></a>  mat.list[[<span class="dv">1</span>]][, col.id[[<span class="dv">1</span>]]] <span class="ot">&lt;-</span> mat</span>
<span id="cb367-18"><a href="chmvdlm.html#cb367-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (id <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(n <span class="sc">-</span> <span class="dv">2</span>)) {</span>
<span id="cb367-19"><a href="chmvdlm.html#cb367-19" aria-hidden="true" tabindex="-1"></a>    start.id <span class="ot">&lt;-</span> col.id[[id <span class="sc">-</span> <span class="dv">1</span>]][<span class="dv">1</span>] <span class="sc">+</span> k</span>
<span id="cb367-20"><a href="chmvdlm.html#cb367-20" aria-hidden="true" tabindex="-1"></a>    end.d <span class="ot">&lt;-</span>  start.id <span class="sc">+</span> (<span class="dv">3</span> <span class="sc">*</span> k <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb367-21"><a href="chmvdlm.html#cb367-21" aria-hidden="true" tabindex="-1"></a>    col.id[[id]] <span class="ot">&lt;-</span> start.id<span class="sc">:</span>end.d</span>
<span id="cb367-22"><a href="chmvdlm.html#cb367-22" aria-hidden="true" tabindex="-1"></a>    mat.list[[id]] <span class="ot">&lt;-</span> zero.mat</span>
<span id="cb367-23"><a href="chmvdlm.html#cb367-23" aria-hidden="true" tabindex="-1"></a>    mat.list[[id]][, col.id[[id]]] <span class="ot">&lt;-</span> mat</span>
<span id="cb367-24"><a href="chmvdlm.html#cb367-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb367-25"><a href="chmvdlm.html#cb367-25" aria-hidden="true" tabindex="-1"></a>  mid.block <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, mat.list)</span>
<span id="cb367-26"><a href="chmvdlm.html#cb367-26" aria-hidden="true" tabindex="-1"></a>  tau.val <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb367-27"><a href="chmvdlm.html#cb367-27" aria-hidden="true" tabindex="-1"></a>  diffuse.prec <span class="ot">&lt;-</span> tau.val <span class="sc">*</span> <span class="fu">diag</span>(<span class="dv">1</span>, k)</span>
<span id="cb367-28"><a href="chmvdlm.html#cb367-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Construct first and last row blocks and then join with mid block</span></span>
<span id="cb367-29"><a href="chmvdlm.html#cb367-29" aria-hidden="true" tabindex="-1"></a>  first.row.block <span class="ot">&lt;-</span></span>
<span id="cb367-30"><a href="chmvdlm.html#cb367-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cbind</span>(A <span class="sc">+</span> diffuse.prec, B, <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> k, <span class="at">ncol =</span> (k <span class="sc">*</span> n <span class="sc">-</span> k <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb367-31"><a href="chmvdlm.html#cb367-31" aria-hidden="true" tabindex="-1"></a>  last.row.block <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> k, <span class="at">ncol =</span> k <span class="sc">*</span> n <span class="sc">-</span> k <span class="sc">^</span> <span class="dv">2</span>), <span class="fu">t</span>(B),C)</span>
<span id="cb367-32"><a href="chmvdlm.html#cb367-32" aria-hidden="true" tabindex="-1"></a>  toep.block.mat <span class="ot">&lt;-</span></span>
<span id="cb367-33"><a href="chmvdlm.html#cb367-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(first.row.block, mid.block, last.row.block)</span>
<span id="cb367-34"><a href="chmvdlm.html#cb367-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Changing to a sparse Matrix</span></span>
<span id="cb367-35"><a href="chmvdlm.html#cb367-35" aria-hidden="true" tabindex="-1"></a>  prec.mat <span class="ot">&lt;-</span> <span class="fu">Matrix</span>(toep.block.mat, <span class="at">sparse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb367-36"><a href="chmvdlm.html#cb367-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(prec.mat)</span>
<span id="cb367-37"><a href="chmvdlm.html#cb367-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>The function <code>mu()</code> is a zero vector:</li>
</ol>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="chmvdlm.html#cb368-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb368-2"><a href="chmvdlm.html#cb368-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">numeric</span>(<span class="dv">0</span>))</span>
<span id="cb368-3"><a href="chmvdlm.html#cb368-3" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The function <code>initial()</code> contains initial values of the parameter <span class="math inline">\(\Theta\)</span> expressed in <code>R-INLA</code>’s internal scale:</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="chmvdlm.html#cb369-1" aria-hidden="true" tabindex="-1"></a>initial <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb369-2"><a href="chmvdlm.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  phi.init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb369-3"><a href="chmvdlm.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  prec.init <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, k)</span>
<span id="cb369-4"><a href="chmvdlm.html#cb369-4" aria-hidden="true" tabindex="-1"></a>  init <span class="ot">&lt;-</span> <span class="fu">c</span>(phi.init, prec.init)</span>
<span id="cb369-5"><a href="chmvdlm.html#cb369-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (init)</span>
<span id="cb369-6"><a href="chmvdlm.html#cb369-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><code>log.norm.constant()</code> denotes the logarithm of the normalizing constant from a multivariate Gaussian distribution.
If we assign <code>numeric(0)</code>, <code>R-INLA</code> will compute this constant.</li>
</ol>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="chmvdlm.html#cb370-1" aria-hidden="true" tabindex="-1"></a>log.norm.const <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb370-2"><a href="chmvdlm.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  Q <span class="ot">&lt;-</span> <span class="fu">Q</span>()</span>
<span id="cb370-3"><a href="chmvdlm.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  log.det.val <span class="ot">&lt;-</span></span>
<span id="cb370-4"><a href="chmvdlm.html#cb370-4" aria-hidden="true" tabindex="-1"></a>    Matrix<span class="sc">::</span><span class="fu">determinant</span>(Q, <span class="at">logarithm =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>modulus</span>
<span id="cb370-5"><a href="chmvdlm.html#cb370-5" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> (<span class="sc">-</span>k <span class="sc">*</span> n <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> log.det.val</span>
<span id="cb370-6"><a href="chmvdlm.html#cb370-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (val)</span>
<span id="cb370-7"><a href="chmvdlm.html#cb370-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>The function <code>log.prior()</code> specifies the priors for the original model parameters on the log scale. Note that although <code>R-INLA</code> works with internal variables (see Chapter <a href="chapter3.html#chapter3">3</a>), the log prior is set on the original parameters, such as <span class="math inline">\(\tau_{11}, \tau_{22}, R_{12}\)</span>, etc. We also include a term for the logarithm of the Jacobian of the transformations from the original to the internal scale of the parameters. Specifically, we set up a normal prior for each of the elements of the <span class="math inline">\(\boldsymbol{\Phi}\)</span> matrix, and log gamma priors for each of the precisions from the <span class="math inline">\(\boldsymbol{W}\)</span> matrix.</li>
</ol>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="chmvdlm.html#cb371-1" aria-hidden="true" tabindex="-1"></a>log.prior <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb371-2"><a href="chmvdlm.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  param <span class="ot">&lt;-</span> <span class="fu">interpret.theta</span>()</span>
<span id="cb371-3"><a href="chmvdlm.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  pars <span class="ot">&lt;-</span> param<span class="sc">$</span>param</span>
<span id="cb371-4"><a href="chmvdlm.html#cb371-4" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> k</span>
<span id="cb371-5"><a href="chmvdlm.html#cb371-5" aria-hidden="true" tabindex="-1"></a>  total.par <span class="ot">&lt;-</span> param<span class="sc">$</span>n.phi <span class="sc">+</span> param<span class="sc">$</span>n.prec</span>
<span id="cb371-6"><a href="chmvdlm.html#cb371-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normal prior for phi&#39;s</span></span>
<span id="cb371-7"><a href="chmvdlm.html#cb371-7" aria-hidden="true" tabindex="-1"></a>  theta.phi <span class="ot">&lt;-</span> theta[<span class="dv">1</span><span class="sc">:</span>param<span class="sc">$</span>n.phi]</span>
<span id="cb371-8"><a href="chmvdlm.html#cb371-8" aria-hidden="true" tabindex="-1"></a>  phi.prior <span class="ot">&lt;-</span></span>
<span id="cb371-9"><a href="chmvdlm.html#cb371-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">sapply</span>(theta.phi, <span class="cf">function</span>(x)</span>
<span id="cb371-10"><a href="chmvdlm.html#cb371-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dnorm</span>(</span>
<span id="cb371-11"><a href="chmvdlm.html#cb371-11" aria-hidden="true" tabindex="-1"></a>        x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span></span>
<span id="cb371-12"><a href="chmvdlm.html#cb371-12" aria-hidden="true" tabindex="-1"></a>      )))</span>
<span id="cb371-13"><a href="chmvdlm.html#cb371-13" aria-hidden="true" tabindex="-1"></a>  theta.prec <span class="ot">&lt;-</span></span>
<span id="cb371-14"><a href="chmvdlm.html#cb371-14" aria-hidden="true" tabindex="-1"></a>    theta[(param<span class="sc">$</span>n.phi <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(param<span class="sc">$</span>n.phi <span class="sc">+</span> param<span class="sc">$</span>n.prec)]</span>
<span id="cb371-15"><a href="chmvdlm.html#cb371-15" aria-hidden="true" tabindex="-1"></a>  prec.prior <span class="ot">&lt;-</span></span>
<span id="cb371-16"><a href="chmvdlm.html#cb371-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">sapply</span>(theta.prec, <span class="cf">function</span>(x)</span>
<span id="cb371-17"><a href="chmvdlm.html#cb371-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dgamma</span>(</span>
<span id="cb371-18"><a href="chmvdlm.html#cb371-18" aria-hidden="true" tabindex="-1"></a>        x,</span>
<span id="cb371-19"><a href="chmvdlm.html#cb371-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb371-20"><a href="chmvdlm.html#cb371-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb371-21"><a href="chmvdlm.html#cb371-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">log =</span> <span class="cn">TRUE</span></span>
<span id="cb371-22"><a href="chmvdlm.html#cb371-22" aria-hidden="true" tabindex="-1"></a>      )))</span>
<span id="cb371-23"><a href="chmvdlm.html#cb371-23" aria-hidden="true" tabindex="-1"></a>  prec.jacob <span class="ot">&lt;-</span> <span class="fu">sum</span>(theta.prec)</span>
<span id="cb371-24"><a href="chmvdlm.html#cb371-24" aria-hidden="true" tabindex="-1"></a>  prior.val <span class="ot">&lt;-</span> phi.prior <span class="sc">+</span> prec.prior <span class="sc">+</span> prec.jacob</span>
<span id="cb371-25"><a href="chmvdlm.html#cb371-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (prior.val)</span>
<span id="cb371-26"><a href="chmvdlm.html#cb371-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The different functions described above are then pulled into the <code>inla.rgeneric.VAR_1()</code> function.
The complete set of functions can be accessed from <code>inla.rgeneric.VAR_1()</code> in Section <a href="resources.html#rgeneric-fn">14.3.1</a>. We can also obtain it from
<!--the custom functions of this book that we sourced at the beginning of the chapter, and in -->
the GitHub link for the book.
If we use <code>R</code> version 4.0 or higher, <code>R-INLA</code> gives a small fix that we must add to our code. These are also shown in the code below.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="chmvdlm.html#cb372-1" aria-hidden="true" tabindex="-1"></a>inla.rgeneric.VAR_1 <span class="ot">&lt;-</span></span>
<span id="cb372-2"><a href="chmvdlm.html#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">cmd =</span> <span class="fu">c</span>(<span class="st">&quot;graph&quot;</span>,</span>
<span id="cb372-3"><a href="chmvdlm.html#cb372-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Q&quot;</span>,</span>
<span id="cb372-4"><a href="chmvdlm.html#cb372-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;mu&quot;</span>,</span>
<span id="cb372-5"><a href="chmvdlm.html#cb372-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;initial&quot;</span>,</span>
<span id="cb372-6"><a href="chmvdlm.html#cb372-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;log.norm.const&quot;</span>,</span>
<span id="cb372-7"><a href="chmvdlm.html#cb372-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;log.prior&quot;</span>,</span>
<span id="cb372-8"><a href="chmvdlm.html#cb372-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;quit&quot;</span>),</span>
<span id="cb372-9"><a href="chmvdlm.html#cb372-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">theta =</span> <span class="cn">NULL</span>)</span>
<span id="cb372-10"><a href="chmvdlm.html#cb372-10" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb372-11"><a href="chmvdlm.html#cb372-11" aria-hidden="true" tabindex="-1"></a>    envir <span class="ot">=</span> <span class="fu">parent.env</span>(<span class="fu">environment</span>())</span>
<span id="cb372-12"><a href="chmvdlm.html#cb372-12" aria-hidden="true" tabindex="-1"></a>    graph <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-13"><a href="chmvdlm.html#cb372-13" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-14"><a href="chmvdlm.html#cb372-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-15"><a href="chmvdlm.html#cb372-15" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-16"><a href="chmvdlm.html#cb372-16" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-17"><a href="chmvdlm.html#cb372-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-18"><a href="chmvdlm.html#cb372-18" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-19"><a href="chmvdlm.html#cb372-19" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-20"><a href="chmvdlm.html#cb372-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-21"><a href="chmvdlm.html#cb372-21" aria-hidden="true" tabindex="-1"></a>    log.norm.const <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-22"><a href="chmvdlm.html#cb372-22" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-23"><a href="chmvdlm.html#cb372-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-24"><a href="chmvdlm.html#cb372-24" aria-hidden="true" tabindex="-1"></a>    log.prior <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-25"><a href="chmvdlm.html#cb372-25" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-26"><a href="chmvdlm.html#cb372-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-27"><a href="chmvdlm.html#cb372-27" aria-hidden="true" tabindex="-1"></a>    initial <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-28"><a href="chmvdlm.html#cb372-28" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-29"><a href="chmvdlm.html#cb372-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-30"><a href="chmvdlm.html#cb372-30" aria-hidden="true" tabindex="-1"></a>    quit <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb372-31"><a href="chmvdlm.html#cb372-31" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb372-32"><a href="chmvdlm.html#cb372-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-33"><a href="chmvdlm.html#cb372-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix for R version higher than 4.0</span></span>
<span id="cb372-34"><a href="chmvdlm.html#cb372-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">as.integer</span>(R.version<span class="sc">$</span>major) <span class="sc">&gt;</span> <span class="dv">3</span>) {</span>
<span id="cb372-35"><a href="chmvdlm.html#cb372-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(theta))</span>
<span id="cb372-36"><a href="chmvdlm.html#cb372-36" aria-hidden="true" tabindex="-1"></a>        theta <span class="ot">&lt;-</span> <span class="fu">initial</span>()</span>
<span id="cb372-37"><a href="chmvdlm.html#cb372-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb372-38"><a href="chmvdlm.html#cb372-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(theta)) {</span>
<span id="cb372-39"><a href="chmvdlm.html#cb372-39" aria-hidden="true" tabindex="-1"></a>        theta <span class="ot">&lt;-</span> <span class="fu">initial</span>()</span>
<span id="cb372-40"><a href="chmvdlm.html#cb372-40" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb372-41"><a href="chmvdlm.html#cb372-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb372-42"><a href="chmvdlm.html#cb372-42" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="fu">match.arg</span>(cmd), <span class="at">args =</span> <span class="fu">list</span>())</span>
<span id="cb372-43"><a href="chmvdlm.html#cb372-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (val)</span></code></pre></div>
<p>The function <code>interpret.theta()</code> enables us to obtain the list of original parameters, along with the items used for the setup, such as the number of elements in <span class="math inline">\(\boldsymbol{\Phi}\)</span>, number of precision parameters in
<span class="math inline">\(\boldsymbol{W}\)</span>, etc.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="chmvdlm.html#cb373-1" aria-hidden="true" tabindex="-1"></a>interpret.theta <span class="ot">&lt;-</span> <span class="cf">function</span>(theta) {</span>
<span id="cb373-2"><a href="chmvdlm.html#cb373-2" aria-hidden="true" tabindex="-1"></a>  n.phi <span class="ot">&lt;-</span> k <span class="sc">*</span> k <span class="sc">*</span> p</span>
<span id="cb373-3"><a href="chmvdlm.html#cb373-3" aria-hidden="true" tabindex="-1"></a>  n.prec <span class="ot">&lt;-</span> k</span>
<span id="cb373-4"><a href="chmvdlm.html#cb373-4" aria-hidden="true" tabindex="-1"></a>  n.tot <span class="ot">&lt;-</span> n.phi <span class="sc">+</span> n.prec</span>
<span id="cb373-5"><a href="chmvdlm.html#cb373-5" aria-hidden="true" tabindex="-1"></a>  phi.VAR <span class="ot">&lt;-</span> <span class="fu">sapply</span>(theta[<span class="fu">as.integer</span>(<span class="dv">1</span><span class="sc">:</span>n.phi)], <span class="cf">function</span>(x) {</span>
<span id="cb373-6"><a href="chmvdlm.html#cb373-6" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb373-7"><a href="chmvdlm.html#cb373-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb373-8"><a href="chmvdlm.html#cb373-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># W matrix  precisions</span></span>
<span id="cb373-9"><a href="chmvdlm.html#cb373-9" aria-hidden="true" tabindex="-1"></a>  wprec <span class="ot">&lt;-</span></span>
<span id="cb373-10"><a href="chmvdlm.html#cb373-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(theta[<span class="fu">as.integer</span>((n.phi <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n.phi <span class="sc">+</span> n.prec))], <span class="cf">function</span>(x) {</span>
<span id="cb373-11"><a href="chmvdlm.html#cb373-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>(x)</span>
<span id="cb373-12"><a href="chmvdlm.html#cb373-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb373-13"><a href="chmvdlm.html#cb373-13" aria-hidden="true" tabindex="-1"></a>  param <span class="ot">&lt;-</span> <span class="fu">c</span>(phi.VAR, wprec)</span>
<span id="cb373-14"><a href="chmvdlm.html#cb373-14" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, n.prec)</span>
<span id="cb373-15"><a href="chmvdlm.html#cb373-15" aria-hidden="true" tabindex="-1"></a>  st.dev <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(wprec)</span>
<span id="cb373-16"><a href="chmvdlm.html#cb373-16" aria-hidden="true" tabindex="-1"></a>  st.dev.mat <span class="ot">&lt;-</span></span>
<span id="cb373-17"><a href="chmvdlm.html#cb373-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matrix</span>(st.dev, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">%*%</span> <span class="fu">matrix</span>(st.dev, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb373-18"><a href="chmvdlm.html#cb373-18" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> W <span class="sc">*</span> st.dev.mat</span>
<span id="cb373-19"><a href="chmvdlm.html#cb373-19" aria-hidden="true" tabindex="-1"></a>  PREC <span class="ot">&lt;-</span> <span class="fu">solve</span>(W)</span>
<span id="cb373-20"><a href="chmvdlm.html#cb373-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb373-21"><a href="chmvdlm.html#cb373-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">param =</span> param,</span>
<span id="cb373-22"><a href="chmvdlm.html#cb373-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">VACOV =</span> W,</span>
<span id="cb373-23"><a href="chmvdlm.html#cb373-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">PREC =</span> PREC,</span>
<span id="cb373-24"><a href="chmvdlm.html#cb373-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">phi.vec =</span> <span class="fu">c</span>(phi.VAR),</span>
<span id="cb373-25"><a href="chmvdlm.html#cb373-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.phi =</span> n.phi,</span>
<span id="cb373-26"><a href="chmvdlm.html#cb373-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.prec =</span> n.prec</span>
<span id="cb373-27"><a href="chmvdlm.html#cb373-27" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb373-28"><a href="chmvdlm.html#cb373-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!--The complete set of functions can be accessed from `inla.rgeneric.VAR_1()` in Section \@ref(rgeneric-fn). We can also obtain it from the custom functions of this book that we sourced at the beginning of the chapter, and in the GitHub link for the book.
-->
<!-- ```{r, echo=FALSE, eval=FALSE} -->
<!-- # Define previous variables as global to avoid warnings() -->
<!-- utils::globalVariables(c("X","p","k","n")) -->
<!-- ``` -->
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="chmvdlm.html#cb374-1" aria-hidden="true" tabindex="-1"></a>model.define <span class="ot">&lt;-</span></span>
<span id="cb374-2"><a href="chmvdlm.html#cb374-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inla.rgeneric.define</span>(inla.rgeneric.VAR_1,</span>
<span id="cb374-3"><a href="chmvdlm.html#cb374-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p =</span> <span class="dv">1</span>,</span>
<span id="cb374-4"><a href="chmvdlm.html#cb374-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">k =</span> <span class="dv">2</span>,</span>
<span id="cb374-5"><a href="chmvdlm.html#cb374-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> n)</span></code></pre></div>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="chmvdlm.html#cb375-1" aria-hidden="true" tabindex="-1"></a>result.rgeneric <span class="ot">&lt;-</span> <span class="fu">inla</span>(</span>
<span id="cb375-2"><a href="chmvdlm.html#cb375-2" aria-hidden="true" tabindex="-1"></a>  formula.rgeneric,</span>
<span id="cb375-3"><a href="chmvdlm.html#cb375-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">c</span>(<span class="st">&quot;gaussian&quot;</span>),</span>
<span id="cb375-4"><a href="chmvdlm.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> inla.dat,</span>
<span id="cb375-5"><a href="chmvdlm.html#cb375-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>, <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb375-6"><a href="chmvdlm.html#cb375-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb375-7"><a href="chmvdlm.html#cb375-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.mode =</span> <span class="fu">list</span>(<span class="at">restart =</span> <span class="cn">TRUE</span>),</span>
<span id="cb375-8"><a href="chmvdlm.html#cb375-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb375-9"><a href="chmvdlm.html#cb375-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial =</span> <span class="dv">15</span>,</span>
<span id="cb375-10"><a href="chmvdlm.html#cb375-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixed =</span> T</span>
<span id="cb375-11"><a href="chmvdlm.html#cb375-11" aria-hidden="true" tabindex="-1"></a>  ))),</span>
<span id="cb375-12"><a href="chmvdlm.html#cb375-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb375-13"><a href="chmvdlm.html#cb375-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb375-14"><a href="chmvdlm.html#cb375-14" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(result.rgeneric)</span></span>
<span id="cb375-15"><a href="chmvdlm.html#cb375-15" aria-hidden="true" tabindex="-1"></a><span class="fu">format.inla.out</span>(result.rgeneric<span class="sc">$</span>summary.hyperpar[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)])</span></code></pre></div>
<pre><code>##   name                               mean  sd    0.5q 
## 1 Theta1 for var.id                  0.709 0.052 0.709
## 2 Theta2 for var.id                  0.106 0.041 0.106
## 3 Theta3 for var.id                  0.340 0.092 0.339
## 4 Theta4 for var.id                  0.211 0.072 0.211
## 5 Theta5 for var.id                  0.581 0.237 0.582
## 6 Theta6 for var.id                  0.833 0.181 0.832
## 7 Precision for iid2d.id component 1 2.519 0.606 2.447
## 8 Precision for iid2d.id component 2 3.004 0.667 2.937
## 9 Rho1:2 for iid2d.id                0.441 0.095 0.447</code></pre>
<p>We run the multivariate DLM model and summarize the true and estimated parameters below. The estimated posterior means are close to the true parameters, even for a moderate sample size of <span class="math inline">\(n=300\)</span>.</p>
<p><strong>Remark.</strong> Models with other specifications for the state vector can be fit by suitably modifying the functions shown above, particularly the functions <!--`mu()`,-->
<code>Q()</code>, <code>log.norm.const()</code>, and <code>log.prior()</code>. Since the source code is fully written in <code>R</code>, the computational time may be high.</p>
</div>
</div>
<div id="chapter-12-appendix" class="section level2 unnumbered hasAnchor">
<h2>Chapter 12 – Appendix<a href="chmvdlm.html#chapter-12-appendix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Vector AR models</strong></p>
<p>Let
<span class="math inline">\(\boldsymbol{x}_t = (X_{t,1}, \ldots, X_{t,k})&#39;\)</span>,
with mean
<span class="math inline">\(E(\boldsymbol{x}_{t}) = \boldsymbol{\mu}\)</span>.
We define the vector autoregressive model of order <span class="math inline">\(p\)</span>, VAR<span class="math inline">\((p)\)</span> model, as</p>
<p><span class="math display" id="eq:varp-1">\[\begin{align}
\boldsymbol{x}_{t} = \boldsymbol{\alpha} + \sum_{j=1}^{p} \boldsymbol{\Phi}_{j} \boldsymbol{x}_{t-j} +  \boldsymbol{w}_{t},
\tag{12.7}
\end{align}\]</span>
where the error vector <span class="math inline">\(\boldsymbol w_t \sim N(\boldsymbol 0, \boldsymbol{W})\)</span>, <span class="math inline">\(\boldsymbol{W}\)</span> being a <span class="math inline">\(k \times k\)</span> p.d. matrix, and
<span class="math inline">\(\boldsymbol{\Phi}_j,~j=1,\ldots,p\)</span> are <span class="math inline">\(k \times k\)</span> state transition matrices. The <span class="math inline">\(k\)</span>-dimensional intercept <span class="math inline">\(\boldsymbol{\alpha}\)</span> can be written in terms of the mean <span class="math inline">\(\boldsymbol{\mu}\)</span> and the coefficient matrices <span class="math inline">\(\boldsymbol{\Phi}_{j},~j=1,\ldots,p\)</span> as</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol{\alpha} = (\boldsymbol{I}_{k} - \sum_{j=1}^p \boldsymbol{\Phi}_{j}) \boldsymbol{\mu}.
\end{align*}\]</span>
The VAR<span class="math inline">\((p)\)</span> operator is defined as</p>
<p><span class="math display">\[\begin{align*}
\boldsymbol{\Phi}(B) = \boldsymbol{I}_{k} - \boldsymbol{\Phi}_{1}B - \ldots - \boldsymbol{\Phi}_{p}B^{p}.   
\end{align*}\]</span>
The process is stationary if the roots of the determinant of <span class="math inline">\(\boldsymbol{\Phi}(z)\)</span> are outside the unit circle, i.e., the modulus of each root is greater than 1. For <span class="math inline">\(p=1\)</span>, the vector autoregressive model of order <span class="math inline">\(1\)</span>, or VAR(1) process, is defined as</p>
<p><span class="math display" id="eq:varp-2">\[\begin{align}
\boldsymbol x_t = \boldsymbol{\alpha} + \boldsymbol{\Phi} \boldsymbol x_{t-1} +  \boldsymbol w_t.
\tag{12.8}
\end{align}\]</span></p>
<p>Let <span class="math inline">\(\boldsymbol{x}_{t},~t=1,\ldots,n\)</span> be observed realizations from the VAR(1) process with zero mean.
The joint distribution of the model parameters given the data <span class="math inline">\((\boldsymbol{x}&#39;_1,\ldots,\boldsymbol{x}&#39;_n)&#39;\)</span> has been derived in <span class="citation">Dutta, Ravishanker, and Basu (<a href="#ref-duttaetal2022" role="doc-biblioref">2022</a>)</span>, assuming that
<span class="math inline">\(\boldsymbol{x}_{1} \sim N(\boldsymbol{0},\frac{1}{\kappa}\boldsymbol{I}_{k})\)</span>,
<span class="math inline">\(\kappa\)</span> being a small number.
Then,</p>
<p><span class="math display" id="eq:varp-3">\[\begin{align}
    \log p(\boldsymbol{x}_t | \boldsymbol{x}_{t-1}) = - \frac{1}{2} \boldsymbol{w}_{t}&#39; \boldsymbol{W}^{-1} \boldsymbol{w}_{t} + C,
\tag{12.9}    
\end{align}\]</span>
where <span class="math inline">\(\boldsymbol{w}_t = \boldsymbol{x}_t - \boldsymbol{\Phi} \boldsymbol{x}_{t-1}\)</span>, <span class="math inline">\(p(.)\)</span> denotes the p.d.f. of the state errors, and <span class="math inline">\(C\)</span> is a constant. To illustrate, when <span class="math inline">\(n=3\)</span>,
the joint distribution of <span class="math inline">\((\boldsymbol{x}&#39;_1,\boldsymbol{x}&#39;_2,\boldsymbol{x}&#39;_3)&#39;\)</span> becomes</p>
<p><span class="math display">\[\begin{align}
\begin{aligned}
    &amp;\log p(\boldsymbol{x}_1,\boldsymbol{x}_2,\boldsymbol{x}_3) =  \log p(\boldsymbol{x}_3|\boldsymbol{x}_{2}) +
    \log p(\boldsymbol{x}_2|\boldsymbol{x}_{1}) +
    \log p(\boldsymbol{x}_{1}) \\
    &amp; = - \dfrac{1}{2}\big[(\boldsymbol{x}_{3} - \boldsymbol{\Phi} \boldsymbol{x}_2)&#39; \boldsymbol{W}^{-1} (\boldsymbol{x}_{3} - \boldsymbol{\Phi} \boldsymbol{x}_2) + (\boldsymbol{x}_{2} - \boldsymbol{\Phi} \boldsymbol{x}_1)&#39; \boldsymbol{W}^{-1} (\boldsymbol{x}_{2} - \boldsymbol{\Phi} \boldsymbol{x}_1)
    + \boldsymbol{x}_{1}&#39; \kappa \boldsymbol{I}_3 \boldsymbol{x}_{1}\big] + C^\ast \\
    &amp; = - \dfrac{1}{2}\big[\boldsymbol{x}_{3}&#39; \boldsymbol{W}^{-1} \boldsymbol{x}_{3} - \boldsymbol{x}_{3}&#39; \boldsymbol{W}^{-1} \boldsymbol{\Phi} \boldsymbol{x}_{2} - \boldsymbol{x}_{2}&#39; \boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1}  \boldsymbol{x}_{3} + \boldsymbol{x}_{2}&#39; \boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1} \boldsymbol{\Phi} \boldsymbol{x}_{2}\\
    &amp; + \boldsymbol{x}_{2}&#39; \boldsymbol{W}^{-1}  \boldsymbol{x}_{2} - \boldsymbol{x}_{2}&#39; \boldsymbol{W}^{-1} \boldsymbol{\Phi}&#39; \boldsymbol{x}_{1} - \boldsymbol{x}_{1}&#39; \boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1} \boldsymbol{x}_{2} + \boldsymbol{x}_{1}&#39; (\boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1} \boldsymbol{\Phi} + \kappa \boldsymbol{I}_3) \boldsymbol{x}_{1} \big],
\end{aligned}
\end{align}\]</span>
where <span class="math inline">\(C^\ast\)</span> is another constant.
Let</p>
<p><span class="math display" id="eq:varp-4">\[\begin{align}
\boldsymbol{A} = \boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1} \boldsymbol{\Phi},
\boldsymbol{B} = - \boldsymbol{\Phi}&#39; \boldsymbol{W}^{-1},
\text{ and }
\boldsymbol{C} = \boldsymbol{W}^{-1}
\tag{12.10}
\end{align}\]</span>
be <span class="math inline">\(k \times k\)</span> matrices. Then, the precision matrix corresponding to the joint distribution of <span class="math inline">\((\boldsymbol{x}&#39;_1,\boldsymbol{x}&#39;_2,\boldsymbol{x}&#39;_3)&#39;\)</span> is a <span class="math inline">\(3k \times 3k\)</span> matrix given by</p>
<p><span class="math display">\[\begin{align*}
\begin{bmatrix}
\boldsymbol{A} + \kappa \boldsymbol{I}_{k}  &amp; \boldsymbol{B}  &amp; \boldsymbol{O}_k  \\
\boldsymbol{B}&#39;  &amp; \boldsymbol{A+C}  &amp; \boldsymbol{B}\\
\boldsymbol{O}_k &amp; \boldsymbol{B}&#39;  &amp; \boldsymbol{C}. \\
\end{bmatrix}
\end{align*}\]</span>
where <span class="math inline">\(\boldsymbol{O}_k\)</span> denotes a <span class="math inline">\(k \times k\)</span> matrix with zero entries.</p>
<p>Using the same approach, the precision matrix in the joint
distribution of
<span class="math inline">\((\boldsymbol{x}&#39;_1,\ldots,\boldsymbol{x}&#39;_n)&#39;\)</span> is derived as</p>
<p><span class="math display">\[\begin{align}
\begin{bmatrix}
\boldsymbol{A} + \kappa \boldsymbol{I}_{k}  &amp; \boldsymbol{B}  &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \boldsymbol{O}_k \\
\boldsymbol{B}&#39;  &amp; \boldsymbol{A+C}  &amp; \boldsymbol{B}  &amp; \ddots &amp; &amp;&amp; &amp; \vdots \\
\vdots  &amp; \boldsymbol{B}&#39; &amp; \boldsymbol{A+C}  &amp; \boldsymbol{B} &amp; &amp;  &amp; \vdots \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp;  &amp; \vdots \\
\vdots &amp; &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots&amp; \vdots\\
\vdots  &amp; &amp; &amp; \ddots &amp; \ddots  &amp; \ddots  &amp; \ddots  &amp; \boldsymbol{O}_k\\
\vdots  &amp; &amp;&amp; &amp; \ddots &amp; \ddots  &amp; \ddots  &amp;  \boldsymbol{B}\\
\boldsymbol{O}_k &amp; \cdots &amp;  \cdots &amp; \cdots &amp; \cdots &amp; \boldsymbol{O}_k &amp; \boldsymbol{B}&#39;  &amp; \boldsymbol{C}\\
\end{bmatrix},
\end{align}\]</span>
where
<span class="math inline">\(\boldsymbol{A}, \boldsymbol{B}\)</span> and
<span class="math inline">\(\boldsymbol{C}\)</span> are <span class="math inline">\(k \times k\)</span> matrices defined in <a href="chmvdlm.html#eq:varp-4">(12.10)</a>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-duttaetal2022" class="csl-entry">
Dutta, Chiranjit, Nalini Ravishanker, and Sumanta Basu. 2022. <span>“Modeling Multivariate Positive-Valued Time Series Using <span>R-INLA</span>.”</span> <em>Arxiv</em>.
</div>
<div id="ref-gomez2020bayesian" class="csl-entry">
Gómez-Rubio, Virgilio. 2020. <em>Bayesian <span>I</span>nference with <span>INLA</span></em>. Boca Raton, Florida: CRC Press.
</div>
<div id="ref-lutkepohl2013" class="csl-entry">
Lütkepohl, Helmut. 2013. <em>Introduction to Multiple Time Series Analysis</em>. Heidelberg: Springer Berlin.
</div>
<div id="ref-martins2013bayesian" class="csl-entry">
Martins, Thiago G., Daniel Simpson, Finn Lindgren, and Håvard Rue. 2013. <span>“Bayesian Computing with <span>INLA</span>: New Features.”</span> <em>Computational Statistics &amp; Data Analysis</em> 67: 68–83.
</div>
<div id="ref-palmi2019bayesian" class="csl-entry">
Palmı́-Perales, Francisco, Virgilio Gómez-Rubio, and Miguel A Martinez-Beneito. 2021. <span>“Bayesian Multivariate Spatial Models for Lattice Data with <span>INLA</span>.”</span> <em>Journal of Statistical Software</em> 98: 1–29.
</div>
<div id="ref-rue2005gaussian" class="csl-entry">
Rue, Håvard, and Leonhard Held. 2005. <em>Gaussian Markov Random Fields: Theory and Applications</em>. Boca Raton, Florida: Chapman &amp; Hall/CRC.
</div>
<div id="ref-ss2017" class="csl-entry">
Shumway, Robert H., and David S. Stoffer. 2017. <em>Time Series Analysis and Its Applications: With r Examples</em>. Springer Texts in Statistics. New York: Springer International Publishing.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-st.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-hmv.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"split_by": "chapter",
"split_bib": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
